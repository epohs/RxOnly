(()=>{(function(){"use strict";var e=window.RxOnly={},t={fast_poll_interval:1e4,slow_poll_interval:2e4,scroll_debounce_delay:2e3,max_poll_failures:3,search_debounce_delay:300},a={current_view:"home",current_channel_index:null,current_channel_name:null,current_channel_url:null,current_node_url:null,breadcrumbs:[{label:"Dashboard",href:"/",view:"home"}],is_loading_more_nodes:!1,previous_view:null,previous_channel_index:null,previous_channel_name:null,previous_channel_url:null,fast_poll_timer:null,slow_poll_timer:null,poll_failure_count:0,known_local_node_id:null,known_first_seen:null,nodes_scroll_timeout:null,nodes_scroll_paused:!1,messages_scroll_timeout:null,messages_scroll_paused:!1,messages_has_more_older:!1,messages_has_more_newer:!1,messages_is_loading:!1,messages_oldest_rx_time:null,messages_newest_rx_time:null,messages_oldest_id:null,messages_newest_id:null,messages_is_dm:!1,messages_total:0,nodes_search_query:"",nodes_search_debounce_timeout:null,nodes_search_request_id:0,total_nodes:0,cached_local_node_name:null,saved_messages_scroll_top:null,saved_messages_is_mobile:!1,saved_messages_channel_index:null,saved_messages_is_dm:!1,navigating_from_content:!1,breadcrumb_last_scroll_y:0,breadcrumb_scroll_up_distance:0,breadcrumb_is_sticky:!1},E={body:document.body,app_layout:document.querySelector(".app-layout"),breadcrumbs_list:document.querySelector(".breadcrumbs ol"),main_content:document.getElementById("main-content"),nodes_list:document.querySelector(".nodes-list"),nodes_count:document.querySelector(".node-count"),channels_list:document.querySelector(".channels-list"),nodes_search_input:document.getElementById("nodes-search-input"),nodes_search_clear:document.getElementById("nodes-search-clear")};function G(r){return r?r.long_name?r.long_name:r.short_name?r.short_name:r.node_id?r.node_id:"":""}function M(r){if(!r||!r.local_node){document.title="RxOnly";return}var s=G(r.local_node),d=r.stats?r.stats.total_nodes:0;a.cached_local_node_name=s,s?document.title=s+" ("+d+")":document.title="RxOnly"}function X(r){a.total_nodes=r,a.cached_local_node_name&&(document.title=a.cached_local_node_name+" ("+r+")"),E.nodes_count&&a.nodes_search_query.trim()===""&&(E.nodes_count.textContent="("+r+")"),E.nodes_list&&(E.nodes_list.dataset.total=r);var s=document.getElementById("dashboard-stat-nodes");s&&(s.textContent=r)}function z(){return E.body.dataset.apiNodeUrlTemplate||"/api/nodes/__NODE_ID__"}function P(r){return z().replace("__NODE_ID__",encodeURIComponent(r))}function Q(r,s){if(s){var d=E.body.dataset.apiDmUrlTemplate||"/api/direct-messages/__MESSAGE_ID__";return d.replace("__MESSAGE_ID__",encodeURIComponent(r))}var m=E.body.dataset.apiMessageUrlTemplate||"/api/messages/__MESSAGE_ID__";return m.replace("__MESSAGE_ID__",encodeURIComponent(r))}function O(r){if(!r)return"";var s=new Date(r*1e3);return s.toLocaleString()}function Z(r){if(!r)return"";var s=new Date(r*1e3);return s.toISOString()}function y(r){var s=document.createElement("div");return s.textContent=r,s.innerHTML}function k(r){return r.long_name&&r.short_name?r.long_name+" ("+r.short_name+")":r.long_name?r.long_name:r.short_name?r.short_name:r.node_id}function T(r){var s=r.long_name||r.from_node_long_name,d=r.short_name||r.from_node_short_name,m=r.node_id||r.from_node;return s&&d?'<span class="node-long-name">'+y(s)+'</span> <span class="node-short-name">('+y(d)+")</span>":s?'<span class="node-long-name">'+y(s)+"</span>":d?'<span class="node-short-name">'+y(d)+"</span>":m?'<span class="node-id">'+y(m)+"</span>":'<span class="node-id">Unknown</span>'}function U(r,s){return s.split(".").reduce(function(d,m){return d?.[m]},r)}function H(r,s,d){for(var m=Object.entries(d),b=0;b<m.length;b++){var A=m[b][0],W=m[b][1],K=r.querySelector(W.selector);if(K){var J;if(W.compute?J=W.compute(s):J=U(s,A),J==null||J===""){var $=K.closest("tr");$&&$.setAttribute("hidden","");continue}W.format&&(J=W.format(J)),W.html?K.innerHTML=String(J):K.textContent=String(J);var ee=K.closest("tr");ee&&ee.removeAttribute("hidden")}}}function I(r,s,d){var m=document.getElementById(r);if(!m)return null;var b=m.content.cloneNode(!0);return H(b,s,d),b}function D(r,s,d){r&&H(r,s,d)}var Y={dashboard:{"local_node.node_id":{selector:"[data-field='node-id']"},"local_node.hardware":{selector:"[data-field='hardware']"},"local_node.role":{selector:"[data-field='role']"},"local_node.first_seen":{selector:"[data-field='first-seen']",format:O},"local_node.last_seen":{selector:"[data-field='last-seen']",format:O},"local_node.battery_level":{selector:"[data-field='battery']",format:function(r){return r+"%"}},"local_node.voltage":{selector:"[data-field='voltage']",format:function(r){return r+"V"}},"stats.total_nodes":{selector:"#dashboard-stat-nodes"},"stats.total_messages":{selector:"#dashboard-stat-messages"},"stats.total_direct_messages":{selector:"#dashboard-stat-dms"},"stats.total_channels":{selector:"#dashboard-stat-channels"}},node_detail:{node_id:{selector:"[data-field='node-id']"},short_name:{selector:"[data-field='short-name']"},long_name:{selector:"[data-field='long-name']"},hardware:{selector:"[data-field='hardware']"},role:{selector:"[data-field='role']"},first_seen:{selector:"[data-field='first-seen']",format:O},last_seen:{selector:"[data-field='last-seen']",format:O},battery_level:{selector:"[data-field='battery']",format:function(r){return r+"%"}},voltage:{selector:"[data-field='voltage']",format:function(r){return r+"V"}},snr:{selector:"[data-field='snr']"},rssi:{selector:"[data-field='rssi']"},latitude:{selector:"[data-field='latitude']"},longitude:{selector:"[data-field='longitude']"},altitude:{selector:"[data-field='altitude']",format:function(r){return r+"m"}}},message_item:{_from_display:{selector:"[data-field='from-node']",compute:T,html:!0},rx_time:{selector:"[data-field='rx-time']",format:O},text:{selector:"[data-field='text']"}},message_detail:{message_id:{selector:"[data-field='message-id']"},_from_display:{selector:"[data-field='from-node']",compute:T,html:!0},to_node:{selector:"[data-field='to-node']"},reply_to:{selector:"[data-field='reply-to']"},text:{selector:"[data-field='text']"},rx_time:{selector:"[data-field='rx-time']",format:O},_channel_display:{selector:"[data-field='channel']",compute:function(r){return r.channel_name||(r.channel_index!=null?"Channel "+r.channel_index:null)}},hop_count:{selector:"[data-field='hop-count']"},snr:{selector:"[data-field='snr']"},rssi:{selector:"[data-field='rssi']"},_via_mqtt:{selector:"[data-field='via-mqtt']",compute:function(r){return r.via_mqtt?"Yes":"No"}}}};function N(r){if(!r)return null;var s=r.getBoundingClientRect(),d=r.querySelectorAll("li");if(d.length===0)return null;for(var m=0;m<d.length;m++){var b=d[m].getBoundingClientRect();if(b.top>=s.top-10)return{element:d[m],offset_from_top:b.top-s.top}}return null}function R(r,s){if(!(!r||!s||!s.element)&&r.contains(s.element)){var d=r.getBoundingClientRect(),m=s.element.getBoundingClientRect(),b=m.top-d.top,A=b-s.offset_from_top;r.scrollTop+=A}}function w(r){return r?r.scrollTop<10:!0}var F=80;function V(){var r=window.scrollY,s=a.breadcrumb_last_scroll_y,d=r-s;if(r<=0){a.breadcrumb_scroll_up_distance=0,a.breadcrumb_is_sticky=!1,E.body.classList.remove("breadcrumbs-sticky","breadcrumbs-hiding"),a.breadcrumb_last_scroll_y=r;return}d>0?(a.breadcrumb_scroll_up_distance=0,a.breadcrumb_is_sticky&&(a.breadcrumb_is_sticky=!1,E.body.classList.add("breadcrumbs-hiding"))):d<0&&(a.breadcrumb_scroll_up_distance+=Math.abs(d),a.breadcrumb_scroll_up_distance>=F&&(E.body.classList.contains("breadcrumbs-hiding")?(E.body.classList.remove("breadcrumbs-hiding"),a.breadcrumb_is_sticky=!0):a.breadcrumb_is_sticky||(a.breadcrumb_is_sticky=!0,E.body.classList.add("breadcrumbs-sticky","breadcrumbs-hiding"),E.body.offsetHeight,E.body.classList.remove("breadcrumbs-hiding")))),a.breadcrumb_last_scroll_y=r}function B(r,s){return r?"rxonly_last_read_dm":"rxonly_last_read_ch_"+s}function o(r,s){try{var d=B(r,s),m=localStorage.getItem(d);if(!m)return null;var b=JSON.parse(m);return b&&typeof b.message_id=="number"&&typeof b.rx_time=="number"?b:null}catch{return null}}function u(r,s,d,m){try{var b=B(r,s);localStorage.setItem(b,JSON.stringify({message_id:d,rx_time:m}))}catch{}}function f(){var r=document.getElementById("messages-list");if(r){for(var s=r.getBoundingClientRect(),d=s.bottom,m=r.querySelectorAll("li[data-message-id]"),b=null,A=0;A<m.length;A++){var W=m[A].getBoundingClientRect();if(W.top<d)b=m[A],v(m[A]);else break}if(b){var K=parseInt(b.dataset.messageId,10),J=parseInt(b.dataset.rxTime||"0",10);if(K&&J){var $=o(a.messages_is_dm,a.current_channel_index);(!$||J>$.rx_time||J===$.rx_time&&K>$.message_id)&&u(a.messages_is_dm,a.current_channel_index,K,J)}}}}function v(r){r.classList.contains("message-read")||(r.classList.remove("message-unread"),r.classList.add("message-read"))}function p(r,s){if(s)for(var d=r.querySelectorAll("li[data-message-id]"),m=0;m<d.length;m++){var b=parseInt(d[m].dataset.rxTime||"0",10),A=parseInt(d[m].dataset.messageId,10);(b<s.rx_time||b===s.rx_time&&A<=s.message_id)&&v(d[m])}}function q(){if(!(a.current_view!=="channel"&&a.current_view!=="direct_messages")){f();var r=document.getElementById("messages-list");if(r){var s=getComputedStyle(r).overflowY==="visible",d=s?window.scrollY:r.scrollTop;d>0&&(a.saved_messages_scroll_top=d,a.saved_messages_is_mobile=s,a.saved_messages_channel_index=a.current_channel_index,a.saved_messages_is_dm=a.current_view==="direct_messages")}}}function L(){a.saved_messages_scroll_top=null,a.saved_messages_is_mobile=!1,a.saved_messages_channel_index=null,a.saved_messages_is_dm=!1}function j(r,s){if(a.saved_messages_scroll_top===null)return null;if(a.saved_messages_is_dm!==r||!r&&a.saved_messages_channel_index!==s)return L(),null;var d={scroll_top:a.saved_messages_scroll_top,is_mobile:a.saved_messages_is_mobile};return L(),d}function n(){return E.body.dataset.apiNodesUrl||"/api/nodes"}function l(){return E.body.dataset.apiStatsUrl||"/api/stats"}function i(r,s,d){var m=n(),b=m+"?offset="+r+"&limit="+s;return d&&(b+="&search="+encodeURIComponent(d)),fetch(b).then(function(A){if(!A.ok)throw new Error("Failed to fetch nodes: "+A.status);return A.json()})}function _(){var r=l();return fetch(r).then(function(s){if(!s.ok)throw new Error("Failed to fetch stats: "+s.status);return s.json()})}function c(r){var s=r.is_dm||!1,d=n().replace("/nodes",s?"/direct-messages":"/messages"),m=new URLSearchParams;!s&&r.channel_index!=null&&m.set("channel_index",String(r.channel_index)),r.after_rx_time!=null&&m.set("after_rx_time",String(r.after_rx_time)),r.before_rx_time!=null&&m.set("before_rx_time",String(r.before_rx_time)),r.newest&&m.set("newest","1"),m.set("limit",String(r.limit||50));var b=d+"?"+m.toString();return fetch(b).then(function(A){if(!A.ok)throw new Error("Failed to fetch "+(s?"direct messages":"messages")+": "+A.status);return A.json()})}function h(r,s){var d=s?r.direct_messages:r.messages;if(a.messages_has_more_older=r.meta.has_more_older,a.messages_has_more_newer=r.meta.has_more_newer,a.messages_total=r.meta.total,d.length>0){var m=d[0],b=d[d.length-1];(a.messages_oldest_rx_time===null||m.rx_time<a.messages_oldest_rx_time||m.rx_time===a.messages_oldest_rx_time&&m.id<a.messages_oldest_id)&&(a.messages_oldest_rx_time=m.rx_time,a.messages_oldest_id=m.id),(a.messages_newest_rx_time===null||b.rx_time>a.messages_newest_rx_time||b.rx_time===a.messages_newest_rx_time&&b.id>a.messages_newest_id)&&(a.messages_newest_rx_time=b.rx_time,a.messages_newest_id=b.id)}}function g(){a.messages_has_more_older=!1,a.messages_has_more_newer=!1,a.messages_is_loading=!1,a.messages_oldest_rx_time=null,a.messages_newest_rx_time=null,a.messages_oldest_id=null,a.messages_newest_id=null,a.messages_total=0,e.clear_pending_tapbacks()}function x(){var r=a.breadcrumbs.map(function(s,d){var m=d===a.breadcrumbs.length-1;return m?'<li><a href="'+s.href+'" aria-current="page" data-view="'+s.view+'">'+y(s.label)+"</a></li>":'<li><a href="'+s.href+'" data-view="'+s.view+'">'+y(s.label)+"</a></li>"}).join("");E.breadcrumbs_list.innerHTML=r}function C(r){a.breadcrumbs=r,x()}function S(){for(var r=document.querySelectorAll(".channel-link.active, .node-link.active"),s=0;s<r.length;s++)r[s].classList.remove("active")}e.config=t,e.app_state=a,e.dom_elements=E,e.field_maps=Y,e.update_page_title=M,e.update_all_node_counts=X,e.format_timestamp=O,e.format_iso_timestamp=Z,e.escape_html=y,e.build_node_url=P,e.build_message_url=Q,e.format_node_display_name=k,e.format_node_display_html=T,e.get_nested_value=U,e.populate_template=I,e.populate_fragment=H,e.update_element=D,e.get_scroll_anchor=N,e.restore_scroll_anchor=R,e.is_at_scroll_top=w,e.handle_breadcrumb_scroll=V,e.get_last_read=o,e.set_last_read=u,e.update_read_position=f,e.mark_message_read=v,e.mark_read_up_to=p,e.save_read_position_before_leave=q,e.clear_saved_scroll_position=L,e.consume_saved_scroll_position=j,e.get_nodes_list_url=n,e.get_stats_url=l,e.fetch_nodes_page=i,e.fetch_stats=_,e.fetch_message_page=c,e.update_message_cursors=h,e.reset_message_state=g,e.set_breadcrumbs=C,e.clear_sidebar_active=S})();(function(){"use strict";var e=window.RxOnly,t=e.app_state,a=e.dom_elements,E=e.config,G=e.field_maps,M=new Map;function X(n){if(!n)return!1;var l=n.trim();if(l.length===0)return!1;var i=new Intl.Segmenter(void 0,{granularity:"grapheme"}),_=Array.from(i.segment(l));if(_.length<1||_.length>3)return!1;for(var c=/\p{Extended_Pictographic}/u,h=0;h<_.length;h++)if(!c.test(_[h].segment))return!1;return!0}function z(n){return n.reply_to!=null&&X(n.text)}function P(){M.clear()}function Q(n){var l=String(n.reply_to);M.has(l)||M.set(l,[]),M.get(l).push(n)}function O(n,l){var i=document.createElement("a");i.className="tapback-pill",i.href=e.build_message_url(n.message_id,l),i.dataset.tapbackId=String(n.message_id);var _=document.createElement("span");if(_.className="tapback-emoji",_.textContent=n.text.trim(),i.appendChild(_),n.from_node_short_name){var c=document.createElement("span");c.className="tapback-author",c.textContent=n.from_node_short_name,i.appendChild(c)}return i}function Z(n,l){var i=document.createElement("span");i.className="tapback-pill tapback-grouped";var _=document.createElement("span");_.className="tapback-emoji",_.textContent=n,i.appendChild(_);var c=document.createElement("span");return c.className="tapback-count",c.textContent=String(l),i.appendChild(c),i}function y(n,l,i){if(n.innerHTML="",l.length!==0){l.sort(function(S,r){return(S.rx_time||0)-(r.rx_time||0)});var _=new Map;l.forEach(function(S){var r=S.text.trim();_.has(r)||_.set(r,[]),_.get(r).push(S)});var c=[],h=10;_.forEach(function(S,r){S.length>5?c.push(Z(r,S.length)):S.forEach(function(s){c.push(O(s,i))})});var g=c.length-h,x=g>0?c.slice(0,h):c;if(x.forEach(function(S){n.appendChild(S)}),g>0){var C=document.createElement("span");C.className="tapback-pill tapback-overflow",C.textContent="+"+g+" more",n.appendChild(C)}}}function k(n,l){var i=String(n.reply_to),_=document.querySelector('#messages-list li[data-message-id="'+i+'"]');if(!_)return!1;var c=_.querySelector(".tapback-container");if(!c){var h=_.querySelector(".message-item");if(!h)return!1;c=document.createElement("div"),c.className="tapback-container",h.appendChild(c)}var g=[],x=c.querySelectorAll("[data-tapback-id]");if(x.forEach(function(r){g.push(r.dataset.tapbackId)}),g.indexOf(String(n.message_id))!==-1)return!0;var C=[];try{var S=c.dataset.tapbacks;S&&(C=JSON.parse(S))}catch{C=[]}return C.push(n),c.dataset.tapbacks=JSON.stringify(C),y(c,C,l),!0}function T(n){if(M.size!==0){var l=[];M.forEach(function(i,_){var c=document.querySelector('#messages-list li[data-message-id="'+_+'"]');c&&(i.forEach(function(h){k(h,n)}),l.push(_))}),l.forEach(function(i){M.delete(i)})}}function U(n,l){if(!n)return"";l=l||120;var i=n.replace(/\n/g," ").replace(/ {2,}/g," ").trim();return i.length<=l?i:i.substring(0,l)+"\u2026"}function H(n,l){var i=e.populate_template("template-message-item",n,G.message_item);if(!i)return null;var _=i.querySelector(".message-from");if(_){var c=n.from_node_long_name||n.from_node_short_name;if(c&&n.from_node)_.href=e.build_node_url(n.from_node),_.dataset.nodeId=n.from_node;else{var h=document.createElement("span");h.className="message-from node-unknown",h.textContent=_.textContent,_.parentNode.replaceChild(h,_)}}var g=i.querySelector(".message-time-link");g&&n.message_id&&(g.href=e.build_message_url(n.message_id,l));var x=i.querySelector(".message-time");if(x&&n.rx_time&&x.setAttribute("datetime",e.format_iso_timestamp(n.rx_time)),n.reply_to!=null&&!z(n)&&n.reply_to_text!=null){var C=i.querySelector(".message-reply-bar");if(C){var S=n.reply_to_from_node_short_name||n.reply_to_from_node||"Unknown",r=U(n.reply_to_text),s=C.querySelector(".message-reply-bar-text");s&&(s.innerHTML='<strong class="message-reply-author">Reply to:</strong> '+e.escape_html(S)+' - <em class="message-reply-excerpt">'+e.escape_html(r)+"</em>"),C.href=e.build_message_url(n.reply_to,l),C.dataset.replyToId=String(n.reply_to),C.removeAttribute("hidden")}}var d=i.querySelector("li");return d&&(d.dataset.messageId=String(n.message_id),n.rx_time!=null&&(d.dataset.rxTime=String(n.rx_time))),i}function I(){var n=document.getElementById("jump-to-newest");n&&(t.messages_has_more_newer?n.removeAttribute("hidden"):n.setAttribute("hidden",""))}function D(n,l,i){var _=[],c=[];l.forEach(function(g){z(g)?c.push(g):_.push(g)});var h=document.createDocumentFragment();_.forEach(function(g){var x=H(g,i);x&&h.appendChild(x)}),n.appendChild(h),c.forEach(function(g){k(g,i)||Q(g)}),T(i)}function Y(n,l,i){var _=getComputedStyle(n).overflowY==="visible",c=_?document.documentElement.scrollHeight:n.scrollHeight,h=[],g=[];l.forEach(function(d){z(d)?g.push(d):h.push(d)});var x=document.createDocumentFragment();h.forEach(function(d){var m=H(d,i);m&&x.appendChild(m)});for(var C=x.querySelectorAll("li[data-message-id]"),S=0;S<C.length;S++)e.mark_message_read(C[S]);n.insertBefore(x,n.firstChild),g.forEach(function(d){k(d,i)||Q(d)}),T(i);var r=_?document.documentElement.scrollHeight:n.scrollHeight,s=r-c;_?window.scrollBy(0,s):n.scrollTop+=s}function N(n,l,i){var _=e.populate_template("template-messages-list",{},{});if(_){var c=_.querySelector("[data-field='heading']");c&&(c.textContent=n);var h=_.querySelector("#messages-list");h&&D(h,l,i),a.main_content.innerHTML="",a.main_content.appendChild(_),T(i),I()}}async function R(n){var l=n.is_dm,i=n.channel_index,_=n.heading;e.reset_message_state(),t.messages_is_dm=l,a.main_content.innerHTML="<p>Loading...</p>";try{var c=e.get_last_read(l,i);if(c){var h=await e.fetch_message_page({is_dm:l,channel_index:i,before_rx_time:c.rx_time+1}),g=l?h.direct_messages:h.messages;if(g.length===0){await w(l,i,_);return}var x=await e.fetch_message_page({is_dm:l,channel_index:i,after_rx_time:c.rx_time}),C=l?x.direct_messages:x.messages,S=g.concat(C);e.update_message_cursors(h,l),e.update_message_cursors(x,l),t.messages_has_more_newer=x.meta.has_more_newer,t.messages_has_more_older=h.meta.has_more_older,N(_,S,l);var r=document.getElementById("messages-list");r&&e.mark_read_up_to(r,c);var s=e.consume_saved_scroll_position(l,i);s!==null&&r?s.is_mobile?window.scrollTo(0,s.scroll_top):r.scrollTop=s.scroll_top:F(c.message_id)}else await w(l,i,_)}catch(m){var d=l?"direct messages":"messages";a.main_content.innerHTML='<p class="error-state">Error loading '+d+": "+e.escape_html(m.message)+"</p>"}}async function w(n,l,i){var _=await e.fetch_message_page({is_dm:n,channel_index:l,newest:!0}),c=n?_.direct_messages:_.messages;if(c.length===0){var h=e.populate_template("template-messages-empty",{},{});if(h){var g=h.querySelector("[data-field='heading']");g&&(g.textContent=i),a.main_content.innerHTML="",a.main_content.appendChild(h)}return}e.update_message_cursors(_,n),N(i,c,n);var x=document.getElementById("messages-list");if(x)for(var C=x.querySelectorAll("li[data-message-id]"),S=0;S<C.length;S++)e.mark_message_read(C[S]);if(c.length>0){var r=c[c.length-1];e.set_last_read(n,l,r.message_id,r.rx_time)}x&&(x.scrollTop=x.scrollHeight)}function F(n){var l=document.getElementById("messages-list");if(l){var i=l.querySelector('li[data-message-id="'+n+'"]');i&&i.scrollIntoView({block:"start"})}}function V(n){return a.channels_list?a.channels_list.querySelector('.channel-link[data-channel-index="'+n+'"]'):null}async function B(n,l,i){if(!V(i))return!1;e.save_read_position_before_leave(),t.current_view="channel",t.current_channel_index=i,t.current_channel_name=l,t.current_channel_url=n,t.current_node_url=null,a.app_layout.classList.add("viewing-detail"),e.clear_sidebar_active();var _=V(i);return _&&_.classList.add("active"),e.set_breadcrumbs([{label:"Dashboard",href:"/",view:"home"},{label:l,href:n,view:"channel"}]),await R({is_dm:!1,channel_index:i,heading:l}),!0}async function o(n){if(e.save_read_position_before_leave(),t.current_view="direct_messages",t.current_channel_index=null,t.current_channel_name="Direct Messages",t.current_channel_url=n,t.current_node_url=null,a.app_layout.classList.add("viewing-detail"),e.clear_sidebar_active(),a.channels_list){var l=a.channels_list.querySelector('.channel-link[data-channel-index="dm"]');l&&l.classList.add("active")}e.set_breadcrumbs([{label:"Dashboard",href:"/",view:"home"},{label:"Direct Messages",href:n,view:"direct_messages"}]),await R({is_dm:!0,channel_index:null,heading:"Direct Messages"})}async function u(n,l){e.save_read_position_before_leave(),t.previous_view=t.current_view,t.previous_channel_index=t.current_channel_index,t.previous_channel_name=t.current_channel_name,t.previous_channel_url=t.current_channel_url,t.current_view="message",t.current_node_url=null,a.app_layout.classList.add("viewing-detail"),a.main_content.innerHTML="<p>Loading...</p>";try{var i=e.build_message_url(n,l),_=await fetch(i),c=await _.json();if(!_.ok){var h=c.error||"Message not found";e.set_breadcrumbs([{label:"Dashboard",href:"/",view:"home"}]),a.main_content.innerHTML='<p class="error-state">'+e.escape_html(h)+"</p>";return}var g=[{label:"Dashboard",href:"/",view:"home"}];if(t.previous_view==="channel"&&t.previous_channel_name)g.push({label:t.previous_channel_name,href:t.previous_channel_url,view:"channel"});else if(t.previous_view==="direct_messages")g.push({label:"Direct Messages",href:t.previous_channel_url,view:"direct_messages"});else if(l){var x=a.channels_list?a.channels_list.querySelector('.channel-link[data-channel-index="dm"]'):null;x&&g.push({label:"Direct Messages",href:x.getAttribute("href"),view:"direct_messages"})}else if(c.channel_index!=null){var C=c.channel_name||"Channel "+c.channel_index,S=a.channels_list?a.channels_list.querySelector('.channel-link[data-channel-index="'+c.channel_index+'"]'):null,r=S?S.getAttribute("href"):"#";g.push({label:C,href:r,view:"channel"})}g.push({label:"Message",href:"#",view:"message"}),e.set_breadcrumbs(g);var s=e.populate_template("template-message-detail",c,G.message_detail);if(s){var d=s.querySelector(".message-detail-from");d&&c.from_node&&(d.href=e.build_node_url(c.from_node),d.dataset.nodeId=c.from_node);var m=s.querySelector(".message-detail-reply-to");m&&c.reply_to!=null&&(m.href=e.build_message_url(c.reply_to,l),m.dataset.replyToId=String(c.reply_to)),a.main_content.innerHTML="",a.main_content.appendChild(s)}}catch{e.set_breadcrumbs([{label:"Dashboard",href:"/",view:"home"}]),a.main_content.innerHTML='<p class="error-state">Error loading message</p>'}}async function f(){var n=document.getElementById("messages-list");if(!(!n||t.messages_is_loading)){t.messages_is_loading=!0,P();try{var l=t.messages_is_dm,i=t.current_channel_index,_=await e.fetch_message_page({is_dm:l,channel_index:i,newest:!0}),c=l?_.direct_messages:_.messages;t.messages_oldest_rx_time=null,t.messages_newest_rx_time=null,t.messages_oldest_id=null,t.messages_newest_id=null,e.update_message_cursors(_,l),n.innerHTML="",D(n,c,l);for(var h=n.querySelectorAll("li[data-message-id]"),g=0;g<h.length;g++)e.mark_message_read(h[g]);if(n.scrollTop=n.scrollHeight,c.length>0){var x=c[c.length-1];e.set_last_read(l,i,x.message_id,x.rx_time)}I()}catch(C){console.error("Jump to newest failed:",C)}finally{t.messages_is_loading=!1}}}async function v(){if(!(t.messages_is_loading||!t.messages_has_more_older)&&t.messages_oldest_rx_time!==null){var n=document.getElementById("messages-list");if(n){t.messages_is_loading=!0;try{var l=t.messages_is_dm,i=t.current_channel_index,_=await e.fetch_message_page({is_dm:l,channel_index:i,before_rx_time:t.messages_oldest_rx_time}),c=l?_.direct_messages:_.messages;if(c.length>0){t.messages_has_more_older=_.meta.has_more_older;var h=c[0];t.messages_oldest_rx_time=h.rx_time,t.messages_oldest_id=h.id,Y(n,c,l)}else t.messages_has_more_older=!1}catch(g){console.error("Load older messages failed:",g)}finally{t.messages_is_loading=!1}}}}async function p(){if(!(t.messages_is_loading||!t.messages_has_more_newer)&&t.messages_newest_rx_time!==null){var n=document.getElementById("messages-list");if(n){t.messages_is_loading=!0;try{var l=t.messages_is_dm,i=t.current_channel_index,_=await e.fetch_message_page({is_dm:l,channel_index:i,after_rx_time:t.messages_newest_rx_time}),c=l?_.direct_messages:_.messages;if(c.length>0){t.messages_has_more_newer=_.meta.has_more_newer;var h=c[c.length-1];t.messages_newest_rx_time=h.rx_time,t.messages_newest_id=h.id,D(n,c,l)}else t.messages_has_more_newer=!1;I()}catch(g){console.error("Load newer messages failed:",g)}finally{t.messages_is_loading=!1}}}}function q(){t.messages_scroll_paused=!0,t.messages_scroll_timeout&&clearTimeout(t.messages_scroll_timeout),t.messages_scroll_timeout=setTimeout(function(){t.messages_scroll_paused=!1},E.scroll_debounce_delay),e.update_read_position();var n=document.getElementById("messages-list");if(n&&n.scrollTop<100&&v(),n){var l=n.querySelector("li:last-child");if(l){var i=n.getBoundingClientRect(),_=l.getBoundingClientRect();_.bottom-i.bottom<200&&p()}}}function L(){if(!(t.current_view!=="channel"&&t.current_view!=="direct_messages")){var n=document.getElementById("messages-list");if(n&&getComputedStyle(n).overflowY==="visible"){t.messages_scroll_paused=!0,t.messages_scroll_timeout&&clearTimeout(t.messages_scroll_timeout),t.messages_scroll_timeout=setTimeout(function(){t.messages_scroll_paused=!1},E.scroll_debounce_delay),e.update_read_position();var l=n.querySelector("li:first-child");if(l){var i=l.getBoundingClientRect();i.top>-100&&v()}var _=n.querySelector("li:last-child");if(_){var c=_.getBoundingClientRect();c.bottom-window.innerHeight<200&&p()}}}}function j(){a.main_content.addEventListener("scroll",function(n){n.target.classList.contains("messages-list")&&q()},!0),a.main_content.addEventListener("click",function(n){var l=n.target.closest("#jump-to-newest");l&&(n.preventDefault(),f())})}e.clear_pending_tapbacks=P,e.show_channel_messages=B,e.show_direct_messages=o,e.show_message_detail=u,e.append_messages_to_list=D,e.update_jump_to_newest_button=I,e.setup_messages_scroll_listener=j,e.handle_messages_window_scroll=L})();(function(){"use strict";var e=window.RxOnly,t=e.app_state,a=e.dom_elements,E=e.config;function G(y){var k=y.target.value.trim();t.nodes_search_debounce_timeout&&clearTimeout(t.nodes_search_debounce_timeout),t.nodes_search_debounce_timeout=setTimeout(function(){t.nodes_search_query=k,a.nodes_search_clear&&(k===""?a.nodes_search_clear.setAttribute("hidden",""):a.nodes_search_clear.removeAttribute("hidden")),M()},E.search_debounce_delay)}async function M(){var y=++t.nodes_search_request_id,k=t.nodes_search_query,T=a.nodes_list;if(T)try{var U=e.get_nodes_list_url(),H;k?H=U+"?search="+encodeURIComponent(k)+"&limit=1000":H=U+"?offset=0&limit=50";var I=await fetch(H);if(!I.ok)throw new Error("Search failed: "+I.status);if(y!==t.nodes_search_request_id)return;var D=await I.json(),Y=document.createDocumentFragment();if(D.nodes.forEach(function(w){var F=document.createElement("li"),V=e.build_node_url(w.node_id),B=document.createElement("a");B.href=V,B.dataset.nodeId=w.node_id,B.className="node-link";var o=document.createElement("span");if(o.className="node-name",o.innerHTML=e.format_node_display_html(w),B.appendChild(o),w.last_seen){var u=document.createElement("time");u.className="node-last-seen",u.setAttribute("datetime",e.format_iso_timestamp(w.last_seen)),u.textContent=e.format_timestamp(w.last_seen),B.appendChild(u)}F.appendChild(B),Y.appendChild(F)}),D.nodes.length===0){var N=document.createElement("li");N.className="empty-state",N.textContent=k?"No matching nodes":"No nodes",Y.appendChild(N)}var R=window.scrollY;T.innerHTML="",T.appendChild(Y),O()&&window.scrollTo(0,R),T.dataset.offset=String(D.nodes.length),T.dataset.total=String(D.meta.total),k?a.nodes_count.textContent="("+D.meta.total+" of "+t.total_nodes+")":e.update_all_node_counts(D.meta.total)}catch(w){console.error("Node search failed:",w)}}function X(){a.nodes_search_input&&(a.nodes_search_input.value=""),t.nodes_search_query="",a.nodes_search_clear&&a.nodes_search_clear.setAttribute("hidden",""),M(),a.nodes_search_input.focus()}async function z(){var y=a.nodes_list;if(y){var k=t.nodes_search_query.trim(),T=e.is_at_scroll_top(y),U=T?null:e.get_scroll_anchor(y);try{var H;if(k){var I=e.get_nodes_list_url(),D=await fetch(I+"?search="+encodeURIComponent(k)+"&limit=1000");if(!D.ok)throw new Error("Failed to fetch nodes");H=await D.json()}else{var Y=parseInt(y.dataset.offset,10)||50;H=await e.fetch_nodes_page(0,Y)}var N={};y.querySelectorAll("li").forEach(function(w){var F=w.querySelector(".node-link");F&&(N[F.dataset.nodeId]=w)});var R=document.createDocumentFragment();H.nodes.forEach(function(w){if(N[w.node_id]){var F=N[w.node_id],V=F.querySelector(".node-name"),B=F.querySelector(".node-last-seen");V&&(V.innerHTML=e.format_node_display_html(w)),B&&w.last_seen&&(B.textContent=e.format_timestamp(w.last_seen)),R.appendChild(F)}else{var o=document.createElement("li"),u=e.build_node_url(w.node_id),f=document.createElement("a");f.href=u,f.dataset.nodeId=w.node_id,f.className="node-link";var v=document.createElement("span");if(v.className="node-name",v.innerHTML=e.format_node_display_html(w),f.appendChild(v),w.last_seen){var p=document.createElement("time");p.className="node-last-seen",p.setAttribute("datetime",e.format_iso_timestamp(w.last_seen)),p.textContent=e.format_timestamp(w.last_seen),f.appendChild(p)}o.appendChild(f),R.appendChild(o)}}),y.innerHTML="",y.appendChild(R),k?a.nodes_count.textContent="("+H.meta.total+" of "+t.total_nodes+")":e.update_all_node_counts(H.meta.total),T?y.scrollTop=0:U&&e.restore_scroll_anchor(y,U)}catch(w){console.error("Failed to update nodes list:",w)}}}async function P(){if(!t.is_loading_more_nodes&&t.nodes_search_query.trim()===""){var y=a.nodes_list,k=parseInt(y.dataset.offset,10)||0,T=parseInt(y.dataset.total,10)||0;if(!(k>=T)){t.is_loading_more_nodes=!0;try{var U=await e.fetch_nodes_page(k,50),H=document.createDocumentFragment();U.nodes.forEach(function(I){var D=document.createElement("li"),Y=e.build_node_url(I.node_id),N=document.createElement("a");N.href=Y,N.dataset.nodeId=I.node_id,N.className="node-link";var R=document.createElement("span");if(R.className="node-name",R.innerHTML=e.format_node_display_html(I),N.appendChild(R),I.last_seen){var w=document.createElement("time");w.className="node-last-seen",w.setAttribute("datetime",e.format_iso_timestamp(I.last_seen)),w.textContent=e.format_timestamp(I.last_seen),N.appendChild(w)}D.appendChild(N),H.appendChild(D)}),y.appendChild(H),y.dataset.offset=k+U.nodes.length}catch(I){console.error("Failed to load more nodes:",I)}finally{t.is_loading_more_nodes=!1}}}}function Q(){var y=a.nodes_list;if(t.nodes_scroll_paused=!0,t.nodes_scroll_timeout&&clearTimeout(t.nodes_scroll_timeout),t.nodes_scroll_timeout=setTimeout(function(){t.nodes_scroll_paused=!1},E.scroll_debounce_delay),t.nodes_search_query.trim()===""){var k=y.scrollTop+y.clientHeight,T=y.scrollHeight-100;k>=T&&P()}}function O(){return a.nodes_list?getComputedStyle(a.nodes_list).overflowY==="visible":!1}function Z(){if(O()&&t.nodes_search_query.trim()===""&&!a.app_layout.classList.contains("viewing-detail")){t.nodes_scroll_paused=!0,t.nodes_scroll_timeout&&clearTimeout(t.nodes_scroll_timeout),t.nodes_scroll_timeout=setTimeout(function(){t.nodes_scroll_paused=!1},E.scroll_debounce_delay);var y=window.scrollY+window.innerHeight,k=document.documentElement.scrollHeight;k-y<200&&P()}}e.handle_nodes_search_input=G,e.fetch_and_render_nodes_search=M,e.clear_nodes_search=X,e.update_nodes_list=z,e.handle_nodes_scroll=Q,e.handle_window_scroll=Z,e.is_mobile_layout=O})();(function(){"use strict";var e=window.RxOnly,t=e.app_state,a=e.dom_elements,E=e.config,G=e.field_maps;async function M(){e.save_read_position_before_leave(),e.clear_saved_scroll_position(),t.current_view="home",t.current_channel_index=null,t.current_channel_name=null,t.current_channel_url=null,t.current_node_url=null,a.app_layout.classList.remove("viewing-detail"),e.clear_sidebar_active(),e.set_breadcrumbs([{label:"Dashboard",href:"/",view:"home"}]);var o=a.main_content.querySelector("#dashboard");if(!o){a.main_content.innerHTML="<p>Loading...</p>";try{var u=await e.fetch_stats(),f=e.populate_template("template-dashboard",u,G.dashboard);if(f){var v=f.querySelector(".dashboard-node-name"),p=f.querySelector(".dashboard-node-short"),q=u.local_node||{};v&&(q.long_name?v.textContent=q.long_name:q.short_name?v.textContent=q.short_name:q.node_id?v.textContent=q.node_id:v.textContent="Unknown Node"),p&&(q.long_name&&q.short_name?p.textContent=q.short_name:p.textContent=""),a.main_content.innerHTML="",a.main_content.appendChild(f)}e.update_page_title(u),z(u)}catch(L){a.main_content.innerHTML='<p class="error-state">Error loading dashboard: '+e.escape_html(L.message)+"</p>",e.update_page_title(null)}}}async function X(o,u){if(e.save_read_position_before_leave(),t.previous_view=t.current_view,t.previous_channel_index=t.current_channel_index,t.previous_channel_name=t.current_channel_name,t.previous_channel_url=t.current_channel_url,t.current_view="node",t.current_node_url=o,a.app_layout.classList.add("viewing-detail"),e.clear_sidebar_active(),a.nodes_list){var f=a.nodes_list.querySelector('.node-link[href="'+o+'"]');f&&f.classList.add("active")}a.main_content.innerHTML="<p>Loading...</p>";try{var v=await fetch(o),p=await v.json();if(!v.ok){var q=p.error||"Node not found";e.set_breadcrumbs([{label:"Dashboard",href:"/",view:"home"}]),a.main_content.innerHTML='<p class="error-state">'+e.escape_html(q)+"</p>";return}var L=p.long_name||p.short_name||p.node_id,j=[{label:"Dashboard",href:"/",view:"home"}];u&&t.previous_view==="channel"&&t.previous_channel_name?j.push({label:t.previous_channel_name,href:t.previous_channel_url,view:"channel"}):u&&t.previous_view==="direct_messages"&&j.push({label:"Direct Messages",href:t.previous_channel_url,view:"direct_messages"}),j.push({label:L,href:o,view:"node"}),e.set_breadcrumbs(j);var n=e.populate_template("template-node-detail",p,G.node_detail);if(n){var l=n.querySelector("[data-field='heading']");if(l&&(l.textContent=e.format_node_display_name(p)),p.latitude!=null&&p.longitude!=null){var i=n.querySelector(".node-map-link"),_=n.querySelector("[data-field='map-link']");i&&_&&(_.href="https://www.openstreetmap.org/?mlat="+p.latitude+"&mlon="+p.longitude+"#map=9",i.removeAttribute("hidden"))}a.main_content.innerHTML="",a.main_content.appendChild(n)}}catch{e.set_breadcrumbs([{label:"Dashboard",href:"/",view:"home"}]),a.main_content.innerHTML='<p class="error-state">Error loading node</p>'}}function z(o){if(!(!o||!o.local_node)){var u=o.local_node;if(t.known_local_node_id===null){t.known_local_node_id=u.node_id,t.known_first_seen=u.first_seen;return}if(u.node_id!==t.known_local_node_id){console.log("Device changed, refreshing page..."),window.location.reload();return}if(u.first_seen!==t.known_first_seen){console.log("Database reset detected, refreshing page..."),window.location.reload();return}}}function P(o){!o||!o.stats||e.update_all_node_counts(o.stats.total_nodes)}function Q(o){if(!(!o||!o.stats)){var u=o.stats,f=u.channel_counts||{};a.channels_list&&a.channels_list.querySelectorAll(".channel-link").forEach(function(v){var p=v.dataset.channelIndex,q=v.querySelector(".channel-count");if(q)if(p==="dm")q.textContent="("+u.total_direct_messages+")";else{var L=f[parseInt(p,10)]||0;q.textContent="("+L+")"}})}}function O(o){if(t.current_view==="home"&&!(!o||!o.stats)){var u=document.getElementById("dashboard");if(u){e.update_element(u,o,G.dashboard);var f=o.local_node||{},v=u.querySelector(".dashboard-node-name"),p=u.querySelector(".dashboard-node-short");v&&(f.long_name?v.textContent=f.long_name:f.short_name?v.textContent=f.short_name:f.node_id&&(v.textContent=f.node_id)),p&&(f.long_name&&f.short_name?p.textContent=f.short_name:p.textContent="")}}}async function Z(){try{var o=await e.fetch_stats();t.poll_failure_count=0,I(),z(o),e.update_page_title(o),P(o),Q(o),O(o)}catch(u){t.poll_failure_count++,console.error("Fast poll failed:",u),t.poll_failure_count>=E.max_poll_failures&&H()}}async function y(){if(!t.nodes_scroll_paused)try{await e.update_nodes_list()}catch(L){console.error("Slow poll (nodes) failed:",L)}if(!t.messages_scroll_paused){if(t.current_view==="channel"&&t.current_channel_index!==null)try{await k(!1)}catch(L){console.error("Slow poll (messages) failed:",L)}else if(t.current_view==="direct_messages")try{await k(!0)}catch(L){console.error("Slow poll (DMs) failed:",L)}}if(t.current_view==="node"&&t.current_node_url)try{var o=await fetch(t.current_node_url);if(o.ok){var u=await o.json(),f=document.querySelector(".node-detail");if(f){e.update_element(f,u,G.node_detail);var v=f.querySelector("[data-field='heading']");if(v&&(v.textContent=e.format_node_display_name(u)),u.latitude!=null&&u.longitude!=null){var p=f.querySelector(".node-map-link"),q=f.querySelector("[data-field='map-link']");p&&q&&(q.href="https://www.openstreetmap.org/?mlat="+u.latitude+"&mlon="+u.longitude+"#map=9",p.removeAttribute("hidden"))}}}}catch(L){console.error("Slow poll (node detail) failed:",L)}}async function k(o){var u=document.getElementById("messages-list");if(u&&!t.messages_is_loading&&t.messages_newest_rx_time!==null)try{var f=await e.fetch_message_page({is_dm:o,channel_index:o?null:t.current_channel_index,after_rx_time:t.messages_newest_rx_time}),v=o?f.direct_messages:f.messages;if(v.length>0){var p=v[v.length-1];t.messages_newest_rx_time=p.rx_time,t.messages_newest_id=p.id,e.append_messages_to_list(u,v,o)}t.messages_has_more_newer=f.meta.has_more_newer,t.messages_total=f.meta.total,e.update_jump_to_newest_button()}catch(q){console.error("Failed to update messages list:",q)}}function T(){U(),t.fast_poll_timer=setInterval(Z,E.fast_poll_interval),t.slow_poll_timer=setInterval(y,E.slow_poll_interval)}function U(){t.fast_poll_timer&&(clearInterval(t.fast_poll_timer),t.fast_poll_timer=null),t.slow_poll_timer&&(clearInterval(t.slow_poll_timer),t.slow_poll_timer=null)}function H(){if(!document.getElementById("connection-error")){var o=document.createElement("div");o.id="connection-error",o.className="connection-error",o.textContent="Connection issue - retrying...",document.body.insertBefore(o,document.body.firstChild)}}function I(){var o=document.getElementById("connection-error");o&&o.remove()}async function D(o){var u=o.replace(/^#/,"");if(!u)return M(),!0;var f=u.split("/"),v=f[0],p=f.slice(1).join("/");if(v==="node"&&p){var q=e.build_node_url(p),L=t.navigating_from_content;return t.navigating_from_content=!1,X(q,L),!0}if(v==="channel"&&p){var j=parseInt(p,10);if(isNaN(j))return!1;var n=a.channels_list?a.channels_list.querySelector('.channel-link[data-channel-index="'+j+'"]'):null;if(!n)return!1;var l=n.querySelector(".channel-name"),i=l?l.textContent.trim():"Channel "+j,_=n.getAttribute("href"),c=await e.show_channel_messages(_,i,j);return c!==!1}if(v==="dm"&&!p){var h=a.channels_list?a.channels_list.querySelector('.channel-link[data-channel-index="dm"]'):null;if(!h)return!1;var g=h.getAttribute("href");return e.show_direct_messages(g),!0}return v==="dm"&&p?(e.show_message_detail(p,!0),!0):v==="message"&&p?(e.show_message_detail(p,!1),!0):!1}function Y(){var o=D(location.hash);o&&typeof o.then=="function"?o.then(function(u){u||(history.replaceState(null,"",location.pathname),M())}):o||(history.replaceState(null,"",location.pathname),M())}function N(o){var u=o.target.closest(".channel-link");if(u){o.preventDefault();var f=u.dataset.channelIndex;f==="dm"?location.hash="dm":location.hash="channel/"+f}}function R(o){var u=o.target.closest(".node-link");if(u){o.preventDefault();var f=u.dataset.nodeId;location.hash="node/"+f}}function w(o){var u=o.target.closest("a");if(u){var f=u.dataset.view;if(o.preventDefault(),f==="home"){if(t.current_view==="home"&&t.breadcrumb_is_sticky){window.scrollTo({top:0,behavior:"smooth"});return}location.hash?location.hash="":M()}else if(f==="channel"){var v=t.current_channel_index!=null?t.current_channel_index:t.previous_channel_index;v!=null&&(location.hash="channel/"+v)}else f==="direct_messages"&&(location.hash="dm")}}function F(o){var u=o.target.closest(".message-reply-bar[data-reply-to-id]");if(u){o.preventDefault();var f=u.dataset.replyToId,v=t.current_view==="direct_messages";location.hash=(v?"dm/":"message/")+f;return}var p=o.target.closest(".message-detail-reply-to[data-reply-to-id]");if(p){o.preventDefault();var q=p.dataset.replyToId,L=t.current_view==="message"&&t.previous_view==="direct_messages";location.hash=(L?"dm/":"message/")+q;return}var j=o.target.closest(".tapback-pill[data-tapback-id]");if(j){o.preventDefault();var n=j.dataset.tapbackId,l=t.current_view==="direct_messages";location.hash=(l?"dm/":"message/")+n;return}var i=o.target.closest(".message-time-link");if(i){o.preventDefault();var _=i.closest("li[data-message-id]");if(_){var c=_.dataset.messageId,h=t.current_view==="direct_messages";location.hash=(h?"dm/":"message/")+c}return}var g=o.target.closest(".node-link");if(g){o.preventDefault(),t.navigating_from_content=!0;var x=g.dataset.nodeId;location.hash="node/"+x;return}}function V(){a.channels_list&&a.channels_list.addEventListener("click",N),a.nodes_list&&(a.nodes_list.addEventListener("click",R),a.nodes_list.addEventListener("scroll",e.handle_nodes_scroll));var o=document.querySelector(".device-bar-home");o&&o.addEventListener("click",function(u){u.preventDefault(),location.hash?location.hash="":M()}),window.addEventListener("hashchange",Y),a.main_content&&a.main_content.addEventListener("click",F),a.nodes_search_input&&(a.nodes_search_input.addEventListener("input",e.handle_nodes_search_input),a.nodes_search_input.addEventListener("keydown",function(u){u.key==="Enter"&&(u.preventDefault(),t.nodes_search_debounce_timeout&&clearTimeout(t.nodes_search_debounce_timeout),t.nodes_search_query=a.nodes_search_input.value.trim(),a.nodes_search_clear&&(t.nodes_search_query===""?a.nodes_search_clear.setAttribute("hidden",""):a.nodes_search_clear.removeAttribute("hidden")),e.fetch_and_render_nodes_search())})),a.nodes_search_clear&&a.nodes_search_clear.addEventListener("click",e.clear_nodes_search),a.breadcrumbs_list&&a.breadcrumbs_list.addEventListener("click",w),e.setup_messages_scroll_listener(),window.addEventListener("scroll",function(){e.handle_window_scroll(),e.handle_messages_window_scroll(),e.handle_breadcrumb_scroll()},{passive:!0})}function B(){document.body.classList.remove("no-js"),V(),location.hash&&location.hash!=="#"?D(location.hash).then(function(o){o||(history.replaceState(null,"",location.pathname),M())}):M(),T()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",B):B()})();})();
