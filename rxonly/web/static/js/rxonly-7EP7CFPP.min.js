(()=>{(function(){"use strict";var e=window.RxOnly={},t={fast_poll_interval:1e4,slow_poll_interval:2e4,scroll_debounce_delay:2e3,max_poll_failures:3,search_debounce_delay:300},a={current_view:"home",current_channel_index:null,current_channel_name:null,current_channel_url:null,current_node_url:null,breadcrumbs:[{label:"Dashboard",href:"/",view:"home"}],is_loading_more_nodes:!1,previous_view:null,previous_channel_index:null,previous_channel_name:null,previous_channel_url:null,fast_poll_timer:null,slow_poll_timer:null,poll_failure_count:0,known_local_node_id:null,known_first_seen:null,nodes_scroll_timeout:null,nodes_scroll_paused:!1,messages_scroll_timeout:null,messages_scroll_paused:!1,messages_has_more_older:!1,messages_has_more_newer:!1,messages_is_loading:!1,messages_oldest_rx_time:null,messages_newest_rx_time:null,messages_oldest_id:null,messages_newest_id:null,messages_is_dm:!1,messages_total:0,nodes_search_query:"",nodes_search_debounce_timeout:null,nodes_search_request_id:0,total_nodes:0,cached_local_node_name:null,saved_messages_scroll_top:null,saved_messages_is_mobile:!1,saved_messages_channel_index:null,saved_messages_is_dm:!1,navigating_from_content:!1,breadcrumb_last_scroll_y:0,breadcrumb_scroll_up_distance:0,breadcrumb_is_sticky:!1},k={body:document.body,app_layout:document.querySelector(".app-layout"),breadcrumbs_list:document.querySelector(".breadcrumbs ol"),main_content:document.getElementById("main-content"),nodes_list:document.querySelector(".nodes-list"),nodes_count:document.querySelector(".node-count"),channels_list:document.querySelector(".channels-list"),nodes_list_heading:document.getElementById("nodes-heading"),nodes_search_input:document.getElementById("nodes-search-input"),nodes_search_clear:document.getElementById("nodes-search-clear")};function G(r){return r?r.long_name?r.long_name:r.short_name?r.short_name:r.node_id?r.node_id:"":""}function D(r){if(!r||!r.local_node){document.title="RxOnly";return}var l=G(r.local_node),d=r.stats?r.stats.total_nodes:0;a.cached_local_node_name=l,l?document.title=l+" ("+d+")":document.title="RxOnly"}function X(r){a.total_nodes=r,a.cached_local_node_name&&(document.title=a.cached_local_node_name+" ("+r+")"),k.nodes_count&&a.nodes_search_query.trim()===""&&(k.nodes_count.textContent="("+r+")"),k.nodes_list&&(k.nodes_list.dataset.total=r);var l=document.getElementById("dashboard-stat-nodes");l&&(l.textContent=r)}function z(){return k.body.dataset.apiNodeUrlTemplate||"/api/nodes/__NODE_ID__"}function P(r){return z().replace("__NODE_ID__",encodeURIComponent(r))}function Q(r,l){if(l){var d=k.body.dataset.apiDmUrlTemplate||"/api/direct-messages/__MESSAGE_ID__";return d.replace("__MESSAGE_ID__",encodeURIComponent(r))}var m=k.body.dataset.apiMessageUrlTemplate||"/api/messages/__MESSAGE_ID__";return m.replace("__MESSAGE_ID__",encodeURIComponent(r))}function j(r){if(!r)return"";var l=new Date(r*1e3);return l.toLocaleString()}function Z(r){if(!r)return"";var l=new Date(r*1e3);return l.toISOString()}function y(r){var l=document.createElement("div");return l.textContent=r,l.innerHTML}function q(r){return r.long_name&&r.short_name?r.long_name+" ("+r.short_name+")":r.long_name?r.long_name:r.short_name?r.short_name:r.node_id}function I(r){var l=r.long_name||r.from_node_long_name,d=r.short_name||r.from_node_short_name,m=r.node_id||r.from_node;return l&&d?'<span class="node-long-name">'+y(l)+'</span> <span class="node-short-name">('+y(d)+")</span>":l?'<span class="node-long-name">'+y(l)+"</span>":d?'<span class="node-short-name">'+y(d)+"</span>":m?'<span class="node-id">'+y(m)+"</span>":'<span class="node-id">Unknown</span>'}function O(r,l){return l.split(".").reduce(function(d,m){return d?.[m]},r)}function M(r,l,d){for(var m=Object.entries(d),b=0;b<m.length;b++){var A=m[b][0],W=m[b][1],K=r.querySelector(W.selector);if(K){var J;if(W.compute?J=W.compute(l):J=O(l,A),J==null||J===""){var $=K.closest("tr");$&&$.setAttribute("hidden","");continue}W.format&&(J=W.format(J)),W.html?K.innerHTML=String(J):K.textContent=String(J);var ee=K.closest("tr");ee&&ee.removeAttribute("hidden")}}}function L(r,l,d){var m=document.getElementById(r);if(!m)return null;var b=m.content.cloneNode(!0);return M(b,l,d),b}function T(r,l,d){r&&M(r,l,d)}var Y={dashboard:{"local_node.node_id":{selector:"[data-field='node-id']"},"local_node.hardware":{selector:"[data-field='hardware']"},"local_node.role":{selector:"[data-field='role']"},"local_node.first_seen":{selector:"[data-field='first-seen']",format:j},"local_node.last_seen":{selector:"[data-field='last-seen']",format:j},"local_node.battery_level":{selector:"[data-field='battery']",format:function(r){return r+"%"}},"local_node.voltage":{selector:"[data-field='voltage']",format:function(r){return r+"V"}},"stats.total_nodes":{selector:"#dashboard-stat-nodes"},"stats.total_messages":{selector:"#dashboard-stat-messages"},"stats.total_direct_messages":{selector:"#dashboard-stat-dms"},"stats.total_channels":{selector:"#dashboard-stat-channels"}},node_detail:{node_id:{selector:"[data-field='node-id']"},short_name:{selector:"[data-field='short-name']"},long_name:{selector:"[data-field='long-name']"},hardware:{selector:"[data-field='hardware']"},role:{selector:"[data-field='role']"},first_seen:{selector:"[data-field='first-seen']",format:j},last_seen:{selector:"[data-field='last-seen']",format:j},battery_level:{selector:"[data-field='battery']",format:function(r){return r+"%"}},voltage:{selector:"[data-field='voltage']",format:function(r){return r+"V"}},snr:{selector:"[data-field='snr']"},rssi:{selector:"[data-field='rssi']"},latitude:{selector:"[data-field='latitude']"},longitude:{selector:"[data-field='longitude']"},altitude:{selector:"[data-field='altitude']",format:function(r){return r+"m"}}},message_item:{_from_display:{selector:"[data-field='from-node']",compute:I,html:!0},rx_time:{selector:"[data-field='rx-time']",format:j},text:{selector:"[data-field='text']"}},message_detail:{message_id:{selector:"[data-field='message-id']"},_from_display:{selector:"[data-field='from-node']",compute:I,html:!0},to_node:{selector:"[data-field='to-node']"},reply_to:{selector:"[data-field='reply-to']"},text:{selector:"[data-field='text']"},rx_time:{selector:"[data-field='rx-time']",format:j},_channel_display:{selector:"[data-field='channel']",compute:function(r){return r.channel_name||(r.channel_index!=null?"Channel "+r.channel_index:null)}},hop_count:{selector:"[data-field='hop-count']"},snr:{selector:"[data-field='snr']"},rssi:{selector:"[data-field='rssi']"},_via_mqtt:{selector:"[data-field='via-mqtt']",compute:function(r){return r.via_mqtt?"Yes":"No"}}}};function H(r){if(!r)return null;var l=r.getBoundingClientRect(),d=r.querySelectorAll("li");if(d.length===0)return null;for(var m=0;m<d.length;m++){var b=d[m].getBoundingClientRect();if(b.top>=l.top-10)return{element:d[m],offset_from_top:b.top-l.top}}return null}function B(r,l){if(!(!r||!l||!l.element)&&r.contains(l.element)){var d=r.getBoundingClientRect(),m=l.element.getBoundingClientRect(),b=m.top-d.top,A=b-l.offset_from_top;r.scrollTop+=A}}function w(r){return r?r.scrollTop<10:!0}var U=80;function V(){var r=window.scrollY,l=a.breadcrumb_last_scroll_y,d=r-l;if(r<=0){a.breadcrumb_scroll_up_distance=0,a.breadcrumb_is_sticky=!1,k.body.classList.remove("breadcrumbs-sticky","breadcrumbs-hiding"),a.breadcrumb_last_scroll_y=r;return}d>0?(a.breadcrumb_scroll_up_distance=0,a.breadcrumb_is_sticky&&(a.breadcrumb_is_sticky=!1,k.body.classList.add("breadcrumbs-hiding"))):d<0&&(a.breadcrumb_scroll_up_distance+=Math.abs(d),a.breadcrumb_scroll_up_distance>=U&&(k.body.classList.contains("breadcrumbs-hiding")?(k.body.classList.remove("breadcrumbs-hiding"),a.breadcrumb_is_sticky=!0):a.breadcrumb_is_sticky||(a.breadcrumb_is_sticky=!0,k.body.classList.add("breadcrumbs-sticky","breadcrumbs-hiding"),k.body.offsetHeight,k.body.classList.remove("breadcrumbs-hiding")))),a.breadcrumb_last_scroll_y=r}function R(r,l){return r?"rxonly_last_read_dm":"rxonly_last_read_ch_"+l}function F(r,l){try{var d=R(r,l),m=localStorage.getItem(d);if(!m)return null;var b=JSON.parse(m);return b&&typeof b.message_id=="number"&&typeof b.rx_time=="number"?b:null}catch{return null}}function o(r,l,d,m){try{var b=R(r,l);localStorage.setItem(b,JSON.stringify({message_id:d,rx_time:m}))}catch{}}function u(){var r=document.getElementById("messages-list");if(r){for(var l=r.getBoundingClientRect(),d=l.bottom,m=r.querySelectorAll("li[data-message-id]"),b=null,A=0;A<m.length;A++){var W=m[A].getBoundingClientRect();if(W.top<d)b=m[A],f(m[A]);else break}if(b){var K=parseInt(b.dataset.messageId,10),J=parseInt(b.dataset.rxTime||"0",10);if(K&&J){var $=F(a.messages_is_dm,a.current_channel_index);(!$||J>$.rx_time||J===$.rx_time&&K>$.message_id)&&o(a.messages_is_dm,a.current_channel_index,K,J)}}}}function f(r){r.classList.contains("message-read")||(r.classList.remove("message-unread"),r.classList.add("message-read"))}function g(r,l){if(l)for(var d=r.querySelectorAll("li[data-message-id]"),m=0;m<d.length;m++){var b=parseInt(d[m].dataset.rxTime||"0",10),A=parseInt(d[m].dataset.messageId,10);(b<l.rx_time||b===l.rx_time&&A<=l.message_id)&&f(d[m])}}function v(){if(!(a.current_view!=="channel"&&a.current_view!=="direct_messages")){u();var r=document.getElementById("messages-list");if(r){var l=getComputedStyle(r).overflowY==="visible",d=l?window.scrollY:r.scrollTop;d>0&&(a.saved_messages_scroll_top=d,a.saved_messages_is_mobile=l,a.saved_messages_channel_index=a.current_channel_index,a.saved_messages_is_dm=a.current_view==="direct_messages")}}}function S(){a.saved_messages_scroll_top=null,a.saved_messages_is_mobile=!1,a.saved_messages_channel_index=null,a.saved_messages_is_dm=!1}function N(r,l){if(a.saved_messages_scroll_top===null)return null;if(a.saved_messages_is_dm!==r||!r&&a.saved_messages_channel_index!==l)return S(),null;var d={scroll_top:a.saved_messages_scroll_top,is_mobile:a.saved_messages_is_mobile};return S(),d}function n(){return k.body.dataset.apiNodesUrl||"/api/nodes"}function s(){return k.body.dataset.apiStatsUrl||"/api/stats"}function _(r,l,d){var m=n(),b=m+"?offset="+r+"&limit="+l;return d&&(b+="&search="+encodeURIComponent(d)),fetch(b).then(function(A){if(!A.ok)throw new Error("Failed to fetch nodes: "+A.status);return A.json()})}function c(){var r=s();return fetch(r).then(function(l){if(!l.ok)throw new Error("Failed to fetch stats: "+l.status);return l.json()})}function i(r){var l=r.is_dm||!1,d=n().replace("/nodes",l?"/direct-messages":"/messages"),m=new URLSearchParams;!l&&r.channel_index!=null&&m.set("channel_index",String(r.channel_index)),r.after_rx_time!=null&&m.set("after_rx_time",String(r.after_rx_time)),r.before_rx_time!=null&&m.set("before_rx_time",String(r.before_rx_time)),r.newest&&m.set("newest","1"),m.set("limit",String(r.limit||50));var b=d+"?"+m.toString();return fetch(b).then(function(A){if(!A.ok)throw new Error("Failed to fetch "+(l?"direct messages":"messages")+": "+A.status);return A.json()})}function h(r,l){var d=l?r.direct_messages:r.messages;if(a.messages_has_more_older=r.meta.has_more_older,a.messages_has_more_newer=r.meta.has_more_newer,a.messages_total=r.meta.total,d.length>0){var m=d[0],b=d[d.length-1];(a.messages_oldest_rx_time===null||m.rx_time<a.messages_oldest_rx_time||m.rx_time===a.messages_oldest_rx_time&&m.id<a.messages_oldest_id)&&(a.messages_oldest_rx_time=m.rx_time,a.messages_oldest_id=m.id),(a.messages_newest_rx_time===null||b.rx_time>a.messages_newest_rx_time||b.rx_time===a.messages_newest_rx_time&&b.id>a.messages_newest_id)&&(a.messages_newest_rx_time=b.rx_time,a.messages_newest_id=b.id)}}function p(){a.messages_has_more_older=!1,a.messages_has_more_newer=!1,a.messages_is_loading=!1,a.messages_oldest_rx_time=null,a.messages_newest_rx_time=null,a.messages_oldest_id=null,a.messages_newest_id=null,a.messages_total=0,e.clear_pending_tapbacks()}function x(){var r=a.breadcrumbs.map(function(l,d){var m=d===a.breadcrumbs.length-1;return m?'<li><a href="'+l.href+'" aria-current="page" data-view="'+l.view+'">'+y(l.label)+"</a></li>":'<li><a href="'+l.href+'" data-view="'+l.view+'">'+y(l.label)+"</a></li>"}).join("");k.breadcrumbs_list.innerHTML=r}function E(r){a.breadcrumbs=r,x()}function C(){for(var r=document.querySelectorAll(".channel-link.active, .node-link.active"),l=0;l<r.length;l++)r[l].classList.remove("active")}e.config=t,e.app_state=a,e.dom_elements=k,e.field_maps=Y,e.update_page_title=D,e.update_all_node_counts=X,e.format_timestamp=j,e.format_iso_timestamp=Z,e.escape_html=y,e.build_node_url=P,e.build_message_url=Q,e.format_node_display_name=q,e.format_node_display_html=I,e.get_nested_value=O,e.populate_template=L,e.populate_fragment=M,e.update_element=T,e.get_scroll_anchor=H,e.restore_scroll_anchor=B,e.is_at_scroll_top=w,e.handle_breadcrumb_scroll=V,e.get_last_read=F,e.set_last_read=o,e.update_read_position=u,e.mark_message_read=f,e.mark_read_up_to=g,e.save_read_position_before_leave=v,e.clear_saved_scroll_position=S,e.consume_saved_scroll_position=N,e.get_nodes_list_url=n,e.get_stats_url=s,e.fetch_nodes_page=_,e.fetch_stats=c,e.fetch_message_page=i,e.update_message_cursors=h,e.reset_message_state=p,e.set_breadcrumbs=E,e.clear_sidebar_active=C})();(function(){"use strict";var e=window.RxOnly,t=e.app_state,a=e.dom_elements,k=e.config,G=e.field_maps,D=new Map;function X(n){if(!n)return!1;var s=n.trim();if(s.length===0)return!1;var _=new Intl.Segmenter(void 0,{granularity:"grapheme"}),c=Array.from(_.segment(s));if(c.length<1||c.length>3)return!1;for(var i=/\p{Extended_Pictographic}/u,h=0;h<c.length;h++)if(!i.test(c[h].segment))return!1;return!0}function z(n){return n.reply_to!=null&&X(n.text)}function P(){D.clear()}function Q(n){var s=String(n.reply_to);D.has(s)||D.set(s,[]),D.get(s).push(n)}function j(n,s){var _=document.createElement("a");_.className="tapback-pill",_.href=e.build_message_url(n.message_id,s),_.dataset.tapbackId=String(n.message_id);var c=document.createElement("span");if(c.className="tapback-emoji",c.textContent=n.text.trim(),_.appendChild(c),n.from_node_short_name){var i=document.createElement("span");i.className="tapback-author",i.textContent=n.from_node_short_name,_.appendChild(i)}return _}function Z(n,s){var _=document.createElement("span");_.className="tapback-pill tapback-grouped";var c=document.createElement("span");c.className="tapback-emoji",c.textContent=n,_.appendChild(c);var i=document.createElement("span");return i.className="tapback-count",i.textContent=String(s),_.appendChild(i),_}function y(n,s,_){if(n.innerHTML="",s.length!==0){s.sort(function(C,r){return(C.rx_time||0)-(r.rx_time||0)});var c=new Map;s.forEach(function(C){var r=C.text.trim();c.has(r)||c.set(r,[]),c.get(r).push(C)});var i=[],h=10;c.forEach(function(C,r){C.length>5?i.push(Z(r,C.length)):C.forEach(function(l){i.push(j(l,_))})});var p=i.length-h,x=p>0?i.slice(0,h):i;if(x.forEach(function(C){n.appendChild(C)}),p>0){var E=document.createElement("span");E.className="tapback-pill tapback-overflow",E.textContent="+"+p+" more",n.appendChild(E)}}}function q(n,s){var _=String(n.reply_to),c=document.querySelector('#messages-list li[data-message-id="'+_+'"]');if(!c)return!1;var i=c.querySelector(".tapback-container");if(!i){var h=c.querySelector(".message-item");if(!h)return!1;i=document.createElement("div"),i.className="tapback-container",h.appendChild(i)}var p=[],x=i.querySelectorAll("[data-tapback-id]");if(x.forEach(function(r){p.push(r.dataset.tapbackId)}),p.indexOf(String(n.message_id))!==-1)return!0;var E=[];try{var C=i.dataset.tapbacks;C&&(E=JSON.parse(C))}catch{E=[]}return E.push(n),i.dataset.tapbacks=JSON.stringify(E),y(i,E,s),!0}function I(n){if(D.size!==0){var s=[];D.forEach(function(_,c){var i=document.querySelector('#messages-list li[data-message-id="'+c+'"]');i&&(_.forEach(function(h){q(h,n)}),s.push(c))}),s.forEach(function(_){D.delete(_)})}}function O(n,s){if(!n)return"";s=s||120;var _=n.replace(/\n/g," ").replace(/ {2,}/g," ").trim();return _.length<=s?_:_.substring(0,s)+"\u2026"}function M(n,s){var _=e.populate_template("template-message-item",n,G.message_item);if(!_)return null;var c=_.querySelector(".message-from");if(c){var i=n.from_node_long_name||n.from_node_short_name;if(i&&n.from_node)c.href=e.build_node_url(n.from_node),c.dataset.nodeId=n.from_node;else{var h=document.createElement("span");h.className="message-from node-unknown",h.textContent=c.textContent,c.parentNode.replaceChild(h,c)}}var p=_.querySelector(".message-time-link");p&&n.message_id&&(p.href=e.build_message_url(n.message_id,s));var x=_.querySelector(".message-time");if(x&&n.rx_time&&x.setAttribute("datetime",e.format_iso_timestamp(n.rx_time)),n.reply_to!=null&&!z(n)&&n.reply_to_text!=null){var E=_.querySelector(".message-reply-bar");if(E){var C=n.reply_to_from_node_short_name||n.reply_to_from_node||"Unknown",r=O(n.reply_to_text),l=E.querySelector(".message-reply-bar-text");l&&(l.innerHTML='<strong class="message-reply-author">Reply to:</strong> '+e.escape_html(C)+' - <em class="message-reply-excerpt">'+e.escape_html(r)+"</em>"),E.href=e.build_message_url(n.reply_to,s),E.dataset.replyToId=String(n.reply_to),E.removeAttribute("hidden")}}var d=_.querySelector("li");return d&&(d.dataset.messageId=String(n.message_id),n.rx_time!=null&&(d.dataset.rxTime=String(n.rx_time))),_}function L(){var n=document.getElementById("jump-to-newest");n&&(t.messages_has_more_newer?n.removeAttribute("hidden"):n.setAttribute("hidden",""))}function T(n,s,_){var c=[],i=[];s.forEach(function(p){z(p)?i.push(p):c.push(p)});var h=document.createDocumentFragment();c.forEach(function(p){var x=M(p,_);x&&h.appendChild(x)}),n.appendChild(h),i.forEach(function(p){q(p,_)||Q(p)}),I(_)}function Y(n,s,_){var c=getComputedStyle(n).overflowY==="visible",i=c?document.documentElement.scrollHeight:n.scrollHeight,h=[],p=[];s.forEach(function(d){z(d)?p.push(d):h.push(d)});var x=document.createDocumentFragment();h.forEach(function(d){var m=M(d,_);m&&x.appendChild(m)});for(var E=x.querySelectorAll("li[data-message-id]"),C=0;C<E.length;C++)e.mark_message_read(E[C]);n.insertBefore(x,n.firstChild),p.forEach(function(d){q(d,_)||Q(d)}),I(_);var r=c?document.documentElement.scrollHeight:n.scrollHeight,l=r-i;c?window.scrollBy(0,l):n.scrollTop+=l}function H(n,s,_){var c=e.populate_template("template-messages-list",{},{});if(c){var i=c.querySelector("[data-field='heading']");i&&(i.textContent=n);var h=c.querySelector("#messages-list");h&&T(h,s,_),a.main_content.innerHTML="",a.main_content.appendChild(c),I(_),L()}}async function B(n){var s=n.is_dm,_=n.channel_index,c=n.heading;e.reset_message_state(),t.messages_is_dm=s,a.main_content.innerHTML="<p>Loading...</p>";try{var i=e.get_last_read(s,_);if(i){var h=await e.fetch_message_page({is_dm:s,channel_index:_,before_rx_time:i.rx_time+1}),p=s?h.direct_messages:h.messages;if(p.length===0){await w(s,_,c);return}var x=await e.fetch_message_page({is_dm:s,channel_index:_,after_rx_time:i.rx_time}),E=s?x.direct_messages:x.messages,C=p.concat(E);e.update_message_cursors(h,s),e.update_message_cursors(x,s),t.messages_has_more_newer=x.meta.has_more_newer,t.messages_has_more_older=h.meta.has_more_older,H(c,C,s);var r=document.getElementById("messages-list");r&&e.mark_read_up_to(r,i);var l=e.consume_saved_scroll_position(s,_);l!==null&&r?l.is_mobile?window.scrollTo(0,l.scroll_top):r.scrollTop=l.scroll_top:U(i.message_id)}else await w(s,_,c)}catch(m){var d=s?"direct messages":"messages";a.main_content.innerHTML='<p class="error-state">Error loading '+d+": "+e.escape_html(m.message)+"</p>"}}async function w(n,s,_){var c=await e.fetch_message_page({is_dm:n,channel_index:s,newest:!0}),i=n?c.direct_messages:c.messages;if(i.length===0){var h=e.populate_template("template-messages-empty",{},{});if(h){var p=h.querySelector("[data-field='heading']");p&&(p.textContent=_),a.main_content.innerHTML="",a.main_content.appendChild(h)}return}e.update_message_cursors(c,n),H(_,i,n);var x=document.getElementById("messages-list");if(x)for(var E=x.querySelectorAll("li[data-message-id]"),C=0;C<E.length;C++)e.mark_message_read(E[C]);if(i.length>0){var r=i[i.length-1];e.set_last_read(n,s,r.message_id,r.rx_time)}x&&(x.scrollTop=x.scrollHeight)}function U(n){var s=document.getElementById("messages-list");if(s){var _=s.querySelector('li[data-message-id="'+n+'"]');_&&_.scrollIntoView({block:"start"})}}function V(n){return a.channels_list?a.channels_list.querySelector('.channel-link[data-channel-index="'+n+'"]'):null}async function R(n,s,_){if(!V(_))return!1;e.save_read_position_before_leave(),t.current_view="channel",t.current_channel_index=_,t.current_channel_name=s,t.current_channel_url=n,t.current_node_url=null,a.app_layout.classList.add("viewing-detail"),e.clear_sidebar_active();var c=V(_);return c&&c.classList.add("active"),e.set_breadcrumbs([{label:"Dashboard",href:"/",view:"home"},{label:s,href:n,view:"channel"}]),await B({is_dm:!1,channel_index:_,heading:s}),!0}async function F(n){if(e.save_read_position_before_leave(),t.current_view="direct_messages",t.current_channel_index=null,t.current_channel_name="Direct Messages",t.current_channel_url=n,t.current_node_url=null,a.app_layout.classList.add("viewing-detail"),e.clear_sidebar_active(),a.channels_list){var s=a.channels_list.querySelector('.channel-link[data-channel-index="dm"]');s&&s.classList.add("active")}e.set_breadcrumbs([{label:"Dashboard",href:"/",view:"home"},{label:"Direct Messages",href:n,view:"direct_messages"}]),await B({is_dm:!0,channel_index:null,heading:"Direct Messages"})}async function o(n,s){e.save_read_position_before_leave(),t.previous_view=t.current_view,t.previous_channel_index=t.current_channel_index,t.previous_channel_name=t.current_channel_name,t.previous_channel_url=t.current_channel_url,t.current_view="message",t.current_node_url=null,a.app_layout.classList.add("viewing-detail"),a.main_content.innerHTML="<p>Loading...</p>";try{var _=e.build_message_url(n,s),c=await fetch(_),i=await c.json();if(!c.ok){var h=i.error||"Message not found";e.set_breadcrumbs([{label:"Dashboard",href:"/",view:"home"}]),a.main_content.innerHTML='<p class="error-state">'+e.escape_html(h)+"</p>";return}var p=[{label:"Dashboard",href:"/",view:"home"}];if(t.previous_view==="channel"&&t.previous_channel_name)p.push({label:t.previous_channel_name,href:t.previous_channel_url,view:"channel"});else if(t.previous_view==="direct_messages")p.push({label:"Direct Messages",href:t.previous_channel_url,view:"direct_messages"});else if(s){var x=a.channels_list?a.channels_list.querySelector('.channel-link[data-channel-index="dm"]'):null;x&&p.push({label:"Direct Messages",href:x.getAttribute("href"),view:"direct_messages"})}else if(i.channel_index!=null){var E=i.channel_name||"Channel "+i.channel_index,C=a.channels_list?a.channels_list.querySelector('.channel-link[data-channel-index="'+i.channel_index+'"]'):null,r=C?C.getAttribute("href"):"#";p.push({label:E,href:r,view:"channel"})}p.push({label:"Message",href:"#",view:"message"}),e.set_breadcrumbs(p);var l=e.populate_template("template-message-detail",i,G.message_detail);if(l){var d=l.querySelector(".message-detail-from");d&&i.from_node&&(d.href=e.build_node_url(i.from_node),d.dataset.nodeId=i.from_node);var m=l.querySelector(".message-detail-reply-to");m&&i.reply_to!=null&&(m.href=e.build_message_url(i.reply_to,s),m.dataset.replyToId=String(i.reply_to)),a.main_content.innerHTML="",a.main_content.appendChild(l)}}catch{e.set_breadcrumbs([{label:"Dashboard",href:"/",view:"home"}]),a.main_content.innerHTML='<p class="error-state">Error loading message</p>'}}async function u(){var n=document.getElementById("messages-list");if(!(!n||t.messages_is_loading)){t.messages_is_loading=!0,P();try{var s=t.messages_is_dm,_=t.current_channel_index,c=await e.fetch_message_page({is_dm:s,channel_index:_,newest:!0}),i=s?c.direct_messages:c.messages;t.messages_oldest_rx_time=null,t.messages_newest_rx_time=null,t.messages_oldest_id=null,t.messages_newest_id=null,e.update_message_cursors(c,s),n.innerHTML="",T(n,i,s);for(var h=n.querySelectorAll("li[data-message-id]"),p=0;p<h.length;p++)e.mark_message_read(h[p]);if(n.scrollTop=n.scrollHeight,i.length>0){var x=i[i.length-1];e.set_last_read(s,_,x.message_id,x.rx_time)}L()}catch(E){console.error("Jump to newest failed:",E)}finally{t.messages_is_loading=!1}}}async function f(){if(!(t.messages_is_loading||!t.messages_has_more_older)&&t.messages_oldest_rx_time!==null){var n=document.getElementById("messages-list");if(n){t.messages_is_loading=!0;try{var s=t.messages_is_dm,_=t.current_channel_index,c=await e.fetch_message_page({is_dm:s,channel_index:_,before_rx_time:t.messages_oldest_rx_time}),i=s?c.direct_messages:c.messages;if(i.length>0){t.messages_has_more_older=c.meta.has_more_older;var h=i[0];t.messages_oldest_rx_time=h.rx_time,t.messages_oldest_id=h.id,Y(n,i,s)}else t.messages_has_more_older=!1}catch(p){console.error("Load older messages failed:",p)}finally{t.messages_is_loading=!1}}}}async function g(){if(!(t.messages_is_loading||!t.messages_has_more_newer)&&t.messages_newest_rx_time!==null){var n=document.getElementById("messages-list");if(n){t.messages_is_loading=!0;try{var s=t.messages_is_dm,_=t.current_channel_index,c=await e.fetch_message_page({is_dm:s,channel_index:_,after_rx_time:t.messages_newest_rx_time}),i=s?c.direct_messages:c.messages;if(i.length>0){t.messages_has_more_newer=c.meta.has_more_newer;var h=i[i.length-1];t.messages_newest_rx_time=h.rx_time,t.messages_newest_id=h.id,T(n,i,s)}else t.messages_has_more_newer=!1;L()}catch(p){console.error("Load newer messages failed:",p)}finally{t.messages_is_loading=!1}}}}function v(){t.messages_scroll_paused=!0,t.messages_scroll_timeout&&clearTimeout(t.messages_scroll_timeout),t.messages_scroll_timeout=setTimeout(function(){t.messages_scroll_paused=!1},k.scroll_debounce_delay),e.update_read_position();var n=document.getElementById("messages-list");if(n&&n.scrollTop<100&&f(),n){var s=n.querySelector("li:last-child");if(s){var _=n.getBoundingClientRect(),c=s.getBoundingClientRect();c.bottom-_.bottom<200&&g()}}}function S(){if(!(t.current_view!=="channel"&&t.current_view!=="direct_messages")){var n=document.getElementById("messages-list");if(n&&getComputedStyle(n).overflowY==="visible"){t.messages_scroll_paused=!0,t.messages_scroll_timeout&&clearTimeout(t.messages_scroll_timeout),t.messages_scroll_timeout=setTimeout(function(){t.messages_scroll_paused=!1},k.scroll_debounce_delay),e.update_read_position();var s=n.querySelector("li:first-child");if(s){var _=s.getBoundingClientRect();_.top>-100&&f()}var c=n.querySelector("li:last-child");if(c){var i=c.getBoundingClientRect();i.bottom-window.innerHeight<200&&g()}}}}function N(){a.main_content.addEventListener("scroll",function(n){n.target.classList.contains("messages-list")&&v()},!0),a.main_content.addEventListener("click",function(n){var s=n.target.closest("#jump-to-newest");s&&(n.preventDefault(),u())})}e.clear_pending_tapbacks=P,e.show_channel_messages=R,e.show_direct_messages=F,e.show_message_detail=o,e.append_messages_to_list=T,e.update_jump_to_newest_button=L,e.setup_messages_scroll_listener=N,e.handle_messages_window_scroll=S})();(function(){"use strict";var e=window.RxOnly,t=e.app_state,a=e.dom_elements,k=e.config;function G(y){var q=y.target.value.trim();t.nodes_search_debounce_timeout&&clearTimeout(t.nodes_search_debounce_timeout),t.nodes_search_debounce_timeout=setTimeout(function(){t.nodes_search_query=q,a.nodes_search_clear&&(q===""?a.nodes_search_clear.setAttribute("hidden",""):a.nodes_search_clear.removeAttribute("hidden")),D()},k.search_debounce_delay)}async function D(){var y=++t.nodes_search_request_id,q=t.nodes_search_query,I=a.nodes_list;if(I)try{var O=e.get_nodes_list_url(),M;q?M=O+"?search="+encodeURIComponent(q)+"&limit=1000":M=O+"?offset=0&limit=50";var L=await fetch(M);if(!L.ok)throw new Error("Search failed: "+L.status);if(y!==t.nodes_search_request_id)return;var T=await L.json(),Y=document.createDocumentFragment();if(T.nodes.forEach(function(w){var U=document.createElement("li"),V=e.build_node_url(w.node_id),R=document.createElement("a");R.href=V,R.dataset.nodeId=w.node_id,R.className="node-link";var F=document.createElement("span");if(F.className="node-name",F.innerHTML=e.format_node_display_html(w),R.appendChild(F),w.last_seen){var o=document.createElement("time");o.className="node-last-seen",o.setAttribute("datetime",e.format_iso_timestamp(w.last_seen)),o.textContent=e.format_timestamp(w.last_seen),R.appendChild(o)}U.appendChild(R),Y.appendChild(U)}),T.nodes.length===0){var H=document.createElement("li");H.className="empty-state",H.textContent=q?"No matching nodes":"No nodes",Y.appendChild(H)}var B=window.scrollY;I.innerHTML="",I.appendChild(Y),j()&&window.scrollTo(0,B),I.dataset.offset=String(T.nodes.length),I.dataset.total=String(T.meta.total),q?a.nodes_count.textContent="("+T.meta.total+" of "+t.total_nodes+")":e.update_all_node_counts(T.meta.total)}catch(w){console.error("Node search failed:",w)}}function X(){a.nodes_search_input&&(a.nodes_search_input.value=""),t.nodes_search_query="",a.nodes_search_clear&&a.nodes_search_clear.setAttribute("hidden",""),D(),a.nodes_search_input.focus()}async function z(){var y=a.nodes_list;if(y){var q=t.nodes_search_query.trim(),I=e.is_at_scroll_top(y),O=I?null:e.get_scroll_anchor(y);try{var M;if(q){var L=e.get_nodes_list_url(),T=await fetch(L+"?search="+encodeURIComponent(q)+"&limit=1000");if(!T.ok)throw new Error("Failed to fetch nodes");M=await T.json()}else{var Y=parseInt(y.dataset.offset,10)||50;M=await e.fetch_nodes_page(0,Y)}var H={};y.querySelectorAll("li").forEach(function(w){var U=w.querySelector(".node-link");U&&(H[U.dataset.nodeId]=w)});var B=document.createDocumentFragment();M.nodes.forEach(function(w){if(H[w.node_id]){var U=H[w.node_id],V=U.querySelector(".node-name"),R=U.querySelector(".node-last-seen");V&&(V.innerHTML=e.format_node_display_html(w)),R&&w.last_seen&&(R.textContent=e.format_timestamp(w.last_seen)),B.appendChild(U)}else{var F=document.createElement("li"),o=e.build_node_url(w.node_id),u=document.createElement("a");u.href=o,u.dataset.nodeId=w.node_id,u.className="node-link";var f=document.createElement("span");if(f.className="node-name",f.innerHTML=e.format_node_display_html(w),u.appendChild(f),w.last_seen){var g=document.createElement("time");g.className="node-last-seen",g.setAttribute("datetime",e.format_iso_timestamp(w.last_seen)),g.textContent=e.format_timestamp(w.last_seen),u.appendChild(g)}F.appendChild(u),B.appendChild(F)}}),y.innerHTML="",y.appendChild(B),q?a.nodes_count.textContent="("+M.meta.total+" of "+t.total_nodes+")":e.update_all_node_counts(M.meta.total),I?y.scrollTop=0:O&&e.restore_scroll_anchor(y,O)}catch(w){console.error("Failed to update nodes list:",w)}}}async function P(){if(!t.is_loading_more_nodes&&t.nodes_search_query.trim()===""){var y=a.nodes_list,q=parseInt(y.dataset.offset,10)||0,I=parseInt(y.dataset.total,10)||0;if(!(q>=I)){t.is_loading_more_nodes=!0;try{var O=await e.fetch_nodes_page(q,50),M=document.createDocumentFragment();O.nodes.forEach(function(L){var T=document.createElement("li"),Y=e.build_node_url(L.node_id),H=document.createElement("a");H.href=Y,H.dataset.nodeId=L.node_id,H.className="node-link";var B=document.createElement("span");if(B.className="node-name",B.innerHTML=e.format_node_display_html(L),H.appendChild(B),L.last_seen){var w=document.createElement("time");w.className="node-last-seen",w.setAttribute("datetime",e.format_iso_timestamp(L.last_seen)),w.textContent=e.format_timestamp(L.last_seen),H.appendChild(w)}T.appendChild(H),M.appendChild(T)}),y.appendChild(M),y.dataset.offset=q+O.nodes.length}catch(L){console.error("Failed to load more nodes:",L)}finally{t.is_loading_more_nodes=!1}}}}function Q(){var y=a.nodes_list;if(t.nodes_scroll_paused=!0,t.nodes_scroll_timeout&&clearTimeout(t.nodes_scroll_timeout),t.nodes_scroll_timeout=setTimeout(function(){t.nodes_scroll_paused=!1},k.scroll_debounce_delay),t.nodes_search_query.trim()===""){var q=y.scrollTop+y.clientHeight,I=y.scrollHeight-100;q>=I&&P()}}function j(){return a.nodes_list?getComputedStyle(a.nodes_list).overflowY==="visible":!1}function Z(){if(j()&&t.nodes_search_query.trim()===""&&!a.app_layout.classList.contains("viewing-detail")){t.nodes_scroll_paused=!0,t.nodes_scroll_timeout&&clearTimeout(t.nodes_scroll_timeout),t.nodes_scroll_timeout=setTimeout(function(){t.nodes_scroll_paused=!1},k.scroll_debounce_delay);var y=window.scrollY+window.innerHeight,q=document.documentElement.scrollHeight;q-y<200&&P()}}e.handle_nodes_search_input=G,e.fetch_and_render_nodes_search=D,e.clear_nodes_search=X,e.update_nodes_list=z,e.handle_nodes_scroll=Q,e.handle_window_scroll=Z,e.is_mobile_layout=j})();(function(){"use strict";var e=window.RxOnly,t=e.app_state,a=e.dom_elements,k=e.config,G=e.field_maps;async function D(){e.save_read_position_before_leave(),e.clear_saved_scroll_position(),t.current_view="home",t.current_channel_index=null,t.current_channel_name=null,t.current_channel_url=null,t.current_node_url=null,a.app_layout.classList.remove("viewing-detail"),e.clear_sidebar_active(),e.set_breadcrumbs([{label:"Dashboard",href:"/",view:"home"}]);var o=a.main_content.querySelector("#dashboard");if(!o){a.main_content.innerHTML="<p>Loading...</p>";try{var u=await e.fetch_stats(),f=e.populate_template("template-dashboard",u,G.dashboard);if(f){var g=f.querySelector(".dashboard-node-name"),v=f.querySelector(".dashboard-node-short"),S=u.local_node||{};g&&(S.long_name?g.textContent=S.long_name:S.short_name?g.textContent=S.short_name:S.node_id?g.textContent=S.node_id:g.textContent="Unknown Node"),v&&(S.long_name&&S.short_name?v.textContent=S.short_name:v.textContent=""),a.main_content.innerHTML="",a.main_content.appendChild(f)}e.update_page_title(u),z(u)}catch(N){a.main_content.innerHTML='<p class="error-state">Error loading dashboard: '+e.escape_html(N.message)+"</p>",e.update_page_title(null)}}}async function X(o,u){if(e.save_read_position_before_leave(),t.previous_view=t.current_view,t.previous_channel_index=t.current_channel_index,t.previous_channel_name=t.current_channel_name,t.previous_channel_url=t.current_channel_url,t.current_view="node",t.current_node_url=o,a.app_layout.classList.add("viewing-detail"),e.clear_sidebar_active(),a.nodes_list){var f=a.nodes_list.querySelector('.node-link[href="'+o+'"]');f&&f.classList.add("active")}a.main_content.innerHTML="<p>Loading...</p>";try{var g=await fetch(o),v=await g.json();if(!g.ok){var S=v.error||"Node not found";e.set_breadcrumbs([{label:"Dashboard",href:"/",view:"home"}]),a.main_content.innerHTML='<p class="error-state">'+e.escape_html(S)+"</p>";return}var N=v.long_name||v.short_name||v.node_id,n=[{label:"Dashboard",href:"/",view:"home"}];u&&t.previous_view==="channel"&&t.previous_channel_name?n.push({label:t.previous_channel_name,href:t.previous_channel_url,view:"channel"}):u&&t.previous_view==="direct_messages"&&n.push({label:"Direct Messages",href:t.previous_channel_url,view:"direct_messages"}),n.push({label:N,href:o,view:"node"}),e.set_breadcrumbs(n);var s=e.populate_template("template-node-detail",v,G.node_detail);if(s){var _=s.querySelector("[data-field='heading']");if(_&&(_.textContent=e.format_node_display_name(v)),v.latitude!=null&&v.longitude!=null){var c=s.querySelector(".node-map-link"),i=s.querySelector("[data-field='map-link']");c&&i&&(i.href="https://www.openstreetmap.org/?mlat="+v.latitude+"&mlon="+v.longitude+"#map=9",c.removeAttribute("hidden"))}a.main_content.innerHTML="",a.main_content.appendChild(s)}}catch{e.set_breadcrumbs([{label:"Dashboard",href:"/",view:"home"}]),a.main_content.innerHTML='<p class="error-state">Error loading node</p>'}}function z(o){if(!(!o||!o.local_node)){var u=o.local_node;if(t.known_local_node_id===null){t.known_local_node_id=u.node_id,t.known_first_seen=u.first_seen;return}if(u.node_id!==t.known_local_node_id){console.log("Device changed, refreshing page..."),window.location.reload();return}if(u.first_seen!==t.known_first_seen){console.log("Database reset detected, refreshing page..."),window.location.reload();return}}}function P(o){!o||!o.stats||e.update_all_node_counts(o.stats.total_nodes)}function Q(o){if(!(!o||!o.stats)){var u=o.stats,f=u.channel_counts||{};a.channels_list&&a.channels_list.querySelectorAll(".channel-link").forEach(function(g){var v=g.dataset.channelIndex,S=g.querySelector(".channel-count");if(S)if(v==="dm")S.textContent="("+u.total_direct_messages+")";else{var N=f[parseInt(v,10)]||0;S.textContent="("+N+")"}})}}function j(o){if(t.current_view==="home"&&!(!o||!o.stats)){var u=document.getElementById("dashboard");if(u){e.update_element(u,o,G.dashboard);var f=o.local_node||{},g=u.querySelector(".dashboard-node-name"),v=u.querySelector(".dashboard-node-short");g&&(f.long_name?g.textContent=f.long_name:f.short_name?g.textContent=f.short_name:f.node_id&&(g.textContent=f.node_id)),v&&(f.long_name&&f.short_name?v.textContent=f.short_name:v.textContent="")}}}async function Z(){try{var o=await e.fetch_stats();t.poll_failure_count=0,L(),z(o),e.update_page_title(o),P(o),Q(o),j(o)}catch(u){t.poll_failure_count++,console.error("Fast poll failed:",u),t.poll_failure_count>=k.max_poll_failures&&M()}}async function y(){if(!t.nodes_scroll_paused)try{await e.update_nodes_list()}catch(N){console.error("Slow poll (nodes) failed:",N)}if(!t.messages_scroll_paused){if(t.current_view==="channel"&&t.current_channel_index!==null)try{await q(!1)}catch(N){console.error("Slow poll (messages) failed:",N)}else if(t.current_view==="direct_messages")try{await q(!0)}catch(N){console.error("Slow poll (DMs) failed:",N)}}if(t.current_view==="node"&&t.current_node_url)try{var o=await fetch(t.current_node_url);if(o.ok){var u=await o.json(),f=document.querySelector(".node-detail");if(f){e.update_element(f,u,G.node_detail);var g=f.querySelector("[data-field='heading']");if(g&&(g.textContent=e.format_node_display_name(u)),u.latitude!=null&&u.longitude!=null){var v=f.querySelector(".node-map-link"),S=f.querySelector("[data-field='map-link']");v&&S&&(S.href="https://www.openstreetmap.org/?mlat="+u.latitude+"&mlon="+u.longitude+"#map=9",v.removeAttribute("hidden"))}}}}catch(N){console.error("Slow poll (node detail) failed:",N)}}async function q(o){var u=document.getElementById("messages-list");if(u&&!t.messages_is_loading&&t.messages_newest_rx_time!==null)try{var f=await e.fetch_message_page({is_dm:o,channel_index:o?null:t.current_channel_index,after_rx_time:t.messages_newest_rx_time}),g=o?f.direct_messages:f.messages;if(g.length>0){var v=g[g.length-1];t.messages_newest_rx_time=v.rx_time,t.messages_newest_id=v.id,e.append_messages_to_list(u,g,o)}t.messages_has_more_newer=f.meta.has_more_newer,t.messages_total=f.meta.total,e.update_jump_to_newest_button()}catch(S){console.error("Failed to update messages list:",S)}}function I(){O(),t.fast_poll_timer=setInterval(Z,k.fast_poll_interval),t.slow_poll_timer=setInterval(y,k.slow_poll_interval)}function O(){t.fast_poll_timer&&(clearInterval(t.fast_poll_timer),t.fast_poll_timer=null),t.slow_poll_timer&&(clearInterval(t.slow_poll_timer),t.slow_poll_timer=null)}function M(){if(!document.getElementById("connection-error")){var o=document.createElement("div");o.id="connection-error",o.className="connection-error",o.textContent="Connection issue - retrying...",document.body.insertBefore(o,document.body.firstChild)}}function L(){var o=document.getElementById("connection-error");o&&o.remove()}async function T(o){var u=o.replace(/^#/,"");if(!u)return D(),!0;var f=u.split("/"),g=f[0],v=f.slice(1).join("/");if(g==="node"&&v){var S=e.build_node_url(v),N=t.navigating_from_content;return t.navigating_from_content=!1,X(S,N),!0}if(g==="channel"&&v){var n=parseInt(v,10);if(isNaN(n))return!1;var s=a.channels_list?a.channels_list.querySelector('.channel-link[data-channel-index="'+n+'"]'):null;if(!s)return!1;var _=s.querySelector(".channel-name"),c=_?_.textContent.trim():"Channel "+n,i=s.getAttribute("href"),h=await e.show_channel_messages(i,c,n);return h!==!1}if(g==="dm"&&!v){var p=a.channels_list?a.channels_list.querySelector('.channel-link[data-channel-index="dm"]'):null;if(!p)return!1;var x=p.getAttribute("href");return e.show_direct_messages(x),!0}return g==="dm"&&v?(e.show_message_detail(v,!0),!0):g==="message"&&v?(e.show_message_detail(v,!1),!0):!1}function Y(){var o=T(location.hash);o&&typeof o.then=="function"?o.then(function(u){u||(history.replaceState(null,"",location.pathname),D())}):o||(history.replaceState(null,"",location.pathname),D())}function H(o){var u=o.target.closest(".channel-link");if(u){o.preventDefault();var f=u.dataset.channelIndex;f==="dm"?location.hash="dm":location.hash="channel/"+f}}function B(o){var u=o.target.closest(".node-link");if(u){o.preventDefault();var f=u.dataset.nodeId;location.hash="node/"+f}}function w(o){!e.is_mobile_layout()&&a.nodes_list&&a.nodes_list.scrollTo({top:0,behavior:"smooth"})}function U(o){var u=o.target.closest("a");if(u){var f=u.dataset.view;if(o.preventDefault(),f==="home"){if(t.current_view==="home"&&t.breadcrumb_is_sticky){window.scrollTo({top:0,behavior:"smooth"});return}location.hash?location.hash="":D()}else if(f==="channel"){var g=t.current_channel_index!=null?t.current_channel_index:t.previous_channel_index;g!=null&&(location.hash="channel/"+g)}else f==="direct_messages"&&(location.hash="dm")}}function V(o){var u=o.target.closest(".message-reply-bar[data-reply-to-id]");if(u){o.preventDefault();var f=u.dataset.replyToId,g=t.current_view==="direct_messages";location.hash=(g?"dm/":"message/")+f;return}var v=o.target.closest(".message-detail-reply-to[data-reply-to-id]");if(v){o.preventDefault();var S=v.dataset.replyToId,N=t.current_view==="message"&&t.previous_view==="direct_messages";location.hash=(N?"dm/":"message/")+S;return}var n=o.target.closest(".tapback-pill[data-tapback-id]");if(n){o.preventDefault();var s=n.dataset.tapbackId,_=t.current_view==="direct_messages";location.hash=(_?"dm/":"message/")+s;return}var c=o.target.closest(".message-time-link");if(c){o.preventDefault();var i=c.closest("li[data-message-id]");if(i){var h=i.dataset.messageId,p=t.current_view==="direct_messages";location.hash=(p?"dm/":"message/")+h}return}var x=o.target.closest(".node-link");if(x){o.preventDefault(),t.navigating_from_content=!0;var E=x.dataset.nodeId;location.hash="node/"+E;return}}function R(){a.channels_list&&a.channels_list.addEventListener("click",H),a.nodes_list_heading&&a.nodes_list_heading.addEventListener("click",w),a.nodes_list&&(a.nodes_list.addEventListener("click",B),a.nodes_list.addEventListener("scroll",e.handle_nodes_scroll));var o=document.querySelector(".device-bar-home");o&&o.addEventListener("click",function(u){u.preventDefault(),location.hash?location.hash="":D()}),window.addEventListener("hashchange",Y),a.main_content&&a.main_content.addEventListener("click",V),a.nodes_search_input&&(a.nodes_search_input.addEventListener("input",e.handle_nodes_search_input),a.nodes_search_input.addEventListener("keydown",function(u){u.key==="Enter"&&(u.preventDefault(),t.nodes_search_debounce_timeout&&clearTimeout(t.nodes_search_debounce_timeout),t.nodes_search_query=a.nodes_search_input.value.trim(),a.nodes_search_clear&&(t.nodes_search_query===""?a.nodes_search_clear.setAttribute("hidden",""):a.nodes_search_clear.removeAttribute("hidden")),e.fetch_and_render_nodes_search())})),a.nodes_search_clear&&a.nodes_search_clear.addEventListener("click",e.clear_nodes_search),a.breadcrumbs_list&&a.breadcrumbs_list.addEventListener("click",U),e.setup_messages_scroll_listener(),window.addEventListener("scroll",function(){e.handle_window_scroll(),e.handle_messages_window_scroll(),e.handle_breadcrumb_scroll()},{passive:!0})}function F(){document.body.classList.remove("no-js"),R(),location.hash&&location.hash!=="#"?T(location.hash).then(function(o){o||(history.replaceState(null,"",location.pathname),D())}):D(),I()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",F):F()})();})();
